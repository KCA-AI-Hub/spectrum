{% extends "base.html" %}

{% block title %}관리자 대시보드 - spectrum 크롤링 비디오 생성 플랫폼{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-10 max-w-7xl">
    <!-- User Info -->
    <div class="absolute top-4 right-4 z-50">
        <div class="user-info">
            <div class="user-avatar admin">
                <i class="icon-crown">👑</i>
            </div>
            <div class="text-right">
                <div class="text-white font-semibold">관리자</div>
                <div class="text-muted text-sm">시스템 관리</div>
            </div>
            <a href="{{ url_for('logout') }}" class="logout-btn">
                로그아웃
            </a>
        </div>
    </div>

    <!-- Header -->
    <div class="header text-center mb-16 pt-20">
        <h1 class="text-5xl font-medium text-white mb-6">관리자 대시보드</h1>
        <p class="text-xl text-muted">spectrum 크롤링 비디오 생성 플랫폼 관리</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="admin-nav mb-8">
        <button class="nav-tab active" onclick="switchTab('crawling')">
            🔍 웹크롤링 관리
        </button>
        <button class="nav-tab" onclick="switchTab('articles')">
            📄 기사 요약 관리
        </button>
        <button class="nav-tab" onclick="switchTab('videos')">
            🎬 영상 제작 관리
        </button>
        <button class="nav-tab" onclick="switchTab('users')">
            👥 사용자 관리
        </button>
    </div>

    <!-- Crawling Management Section -->
    <div id="crawling-section" class="tab-content active">
        <div class="section-header">
            <h2 class="text-3xl font-semibold text-white mb-2">웹크롤링 관리</h2>
            <p class="text-muted mb-6">키워드 기반 자동 크롤링 설정 및 관리</p>
        </div>

        <!-- Quick Stats -->
        <div class="stats-grid mb-8">
            <div class="stat-card">
                <div class="stat-icon">🔍</div>
                <div class="stat-content">
                    <div class="stat-number">24</div>
                    <div class="stat-label">활성 크롤링 작업</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📰</div>
                <div class="stat-content">
                    <div class="stat-number">1,247</div>
                    <div class="stat-label">오늘 수집된 기사</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⚡</div>
                <div class="stat-content">
                    <div class="stat-number">98%</div>
                    <div class="stat-label">수집 성공률</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📈</div>
                <div class="stat-content">
                    <div class="stat-number">+15%</div>
                    <div class="stat-label">전일 대비 증가</div>
                </div>
            </div>
        </div>

        <!-- Crawling Control Panel -->
        <div class="control-panel mb-8">
            <div class="panel-header">
                <h3 class="text-xl font-semibold text-white">네이버 뉴스 크롤링</h3>
                <button class="btn-primary" onclick="startCrawling()">
                    <i class="icon">🔍</i> AI 키워드 크롤링 시작
                </button>
            </div>
            
            <!-- Crawling Form -->
            <div class="crawling-form">
                <h4 class="text-lg font-medium text-white mb-4">크롤링 설정</h4>
                <div class="crawling-input-group">
                    <div class="input-section">
                        <label class="input-label">크롤링 키워드</label>
                        <input type="text" id="crawl-keyword" class="keyword-input" value="ai" placeholder="크롤링할 키워드 입력">
                    </div>
                    <div class="input-section">
                        <label class="input-label">대상 사이트</label>
                        <input type="text" id="crawl-url" class="keyword-input" value="https://news.naver.com/" readonly placeholder="크롤링 대상 URL">
                    </div>
                    <div class="input-section">
                        <label class="input-label">카테고리</label>
                        <select id="crawl-category" class="category-select">
                            <option value="technology">기술</option>
                            <option value="policy">정책</option>
                            <option value="industry">산업</option>
                            <option value="research">연구</option>
                        </select>
                    </div>
                </div>
                
                <!-- Crawling Status -->
                <div id="crawling-status" class="crawling-status hidden">
                    <div class="status-header">
                        <h5 class="status-title">크롤링 진행 상황</h5>
                        <div class="status-indicator running">진행중</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="crawl-progress" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="progress-text">0%</span>
                    </div>
                    <div class="status-details">
                        <span id="crawl-details">크롤링을 준비하고 있습니다...</span>
                    </div>
                </div>
            </div>
            
            <!-- Crawling Results -->
            <div id="crawling-results" class="crawling-results hidden">
                <div class="results-header">
                    <h4 class="text-lg font-medium text-white">크롤링 결과</h4>
                    <div class="results-meta">
                        <span id="results-count">0개 기사 수집</span>
                        <span id="results-time">-</span>
                    </div>
                </div>
                <div id="articles-list" class="articles-list">
                    <!-- 크롤링된 기사들이 여기에 표시됩니다 -->
                </div>
                <div class="results-actions">
                    <button class="btn-secondary" onclick="clearResults()">결과 지우기</button>
                    <button class="btn-primary" onclick="exportResults()">결과 내보내기</button>
                </div>
            </div>
        </div>

        <!-- Active Crawling Jobs -->
        <div class="jobs-section">
            <h3 class="text-xl font-semibold text-white mb-4">활성 크롤링 작업</h3>
            <div class="jobs-grid">
                <div class="job-card">
                    <div class="job-header">
                        <div class="job-title">6G 기술 동향</div>
                        <div class="job-status running">실행중</div>
                    </div>
                    <div class="job-details">
                        <div class="job-meta">
                            <span>키워드: 6G, 차세대통신</span>
                            <span>수집: 23개 기사</span>
                        </div>
                        <div class="job-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                            <span class="progress-text">75%</span>
                        </div>
                    </div>
                    <div class="job-actions">
                        <button class="btn-secondary">일시정지</button>
                        <button class="btn-danger">중지</button>
                        <button class="btn-primary">설정</button>
                    </div>
                </div>

                <div class="job-card">
                    <div class="job-header">
                        <div class="job-title">전파정책 모니터링</div>
                        <div class="job-status scheduled">예약됨</div>
                    </div>
                    <div class="job-details">
                        <div class="job-meta">
                            <span>키워드: 전파정책, 주파수</span>
                            <span>예정: 14:00 시작</span>
                        </div>
                        <div class="job-schedule">
                            <span>매일 14:00, 18:00 실행</span>
                        </div>
                    </div>
                    <div class="job-actions">
                        <button class="btn-primary">즉시 실행</button>
                        <button class="btn-secondary">설정</button>
                        <button class="btn-danger">삭제</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Articles Management Section -->
    <div id="articles-section" class="tab-content">
        <div class="section-header">
            <h2 class="text-3xl font-semibold text-white mb-2">기사 요약 관리</h2>
            <p class="text-muted mb-6">수집된 기사의 요약 및 승인 관리</p>
        </div>

        <!-- Article Stats -->
        <div class="stats-grid mb-8">
            <div class="stat-card">
                <div class="stat-icon">📄</div>
                <div class="stat-content">
                    <div class="stat-number">156</div>
                    <div class="stat-label">요약 대기 기사</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">✅</div>
                <div class="stat-content">
                    <div class="stat-number">89</div>
                    <div class="stat-label">승인된 요약</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⏰</div>
                <div class="stat-content">
                    <div class="stat-number">12</div>
                    <div class="stat-label">검토 대기</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🤖</div>
                <div class="stat-content">
                    <div class="stat-number">92%</div>
                    <div class="stat-label">AI 요약 정확도</div>
                </div>
            </div>
        </div>

        <!-- Article Filters -->
        <div class="filter-panel mb-6">
            <div class="filter-group">
                <select class="filter-select">
                    <option value="">모든 상태</option>
                    <option value="pending">요약 대기</option>
                    <option value="summarized">요약 완료</option>
                    <option value="approved">승인됨</option>
                    <option value="rejected">거부됨</option>
                </select>
                <select class="filter-select">
                    <option value="">모든 카테고리</option>
                    <option value="technology">기술</option>
                    <option value="policy">정책</option>
                    <option value="industry">산업</option>
                </select>
                <input type="date" class="filter-date">
                <button class="btn-filter">필터 적용</button>
                <button class="btn-secondary">초기화</button>
            </div>
        </div>

        <!-- Articles List -->
        <div class="articles-grid">
            <div class="article-card">
                <div class="article-header">
                    <div class="article-title">6G 상용화 로드맵 발표, 2030년 목표</div>
                    <div class="article-status pending">요약 대기</div>
                </div>
                <div class="article-meta">
                    <span class="article-source">📺 KCA 뉴스</span>
                    <span class="article-date">2024-01-15 09:30</span>
                    <span class="article-category technology">기술</span>
                </div>
                <div class="article-preview">
                    과학기술정보통신부는 6G 이동통신 상용화를 위한 로드맵을 발표했다. 2030년 상용 서비스 개시를 목표로...
                </div>
                <div class="article-actions">
                    <button class="btn-primary">AI 요약 생성</button>
                    <button class="btn-secondary">원문 보기</button>
                    <button class="btn-danger">삭제</button>
                </div>
            </div>

            <div class="article-card">
                <div class="article-header">
                    <div class="article-title">위성통신 주파수 국제 조정 회의 결과</div>
                    <div class="article-status summarized">요약 완료</div>
                </div>
                <div class="article-meta">
                    <span class="article-source">🌐 연합뉴스</span>
                    <span class="article-date">2024-01-15 08:15</span>
                    <span class="article-category policy">정책</span>
                </div>
                <div class="article-summary">
                    <h5>AI 생성 요약:</h5>
                    <p>ITU 세계전파통신회의(WRC-23)에서 위성통신 주파수 대역 할당에 대한 국제 합의가 이루어졌습니다. 한국은 Ka 대역과 V 대역에서 추가 주파수를 확보했습니다.</p>
                </div>
                <div class="article-actions">
                    <button class="btn-success">승인</button>
                    <button class="btn-warning">수정</button>
                    <button class="btn-danger">거부</button>
                    <button class="btn-secondary">원문 보기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Videos Management Section -->
    <div id="videos-section" class="tab-content">
        <div class="section-header">
            <h2 class="text-3xl font-semibold text-white mb-2">영상 제작 관리</h2>
            <p class="text-muted mb-6">승인된 스크립트의 영상 제작 및 관리</p>
        </div>

        <!-- Video Stats -->
        <div class="stats-grid mb-8">
            <div class="stat-card">
                <div class="stat-icon">🎬</div>
                <div class="stat-content">
                    <div class="stat-number">23</div>
                    <div class="stat-label">제작 대기 스크립트</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🎥</div>
                <div class="stat-content">
                    <div class="stat-number">8</div>
                    <div class="stat-label">제작 진행중</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">✨</div>
                <div class="stat-content">
                    <div class="stat-number">45</div>
                    <div class="stat-label">제작 완료</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⏱️</div>
                <div class="stat-content">
                    <div class="stat-number">12분</div>
                    <div class="stat-label">평균 제작 시간</div>
                </div>
            </div>
        </div>

        <!-- Production Queue -->
        <div class="production-panel mb-8">
            <div class="panel-header">
                <h3 class="text-xl font-semibold text-white">제작 대기열</h3>
                <button class="btn-primary" onclick="openVideoModal()">
                    <i class="icon">🎬</i> 새 영상 제작
                </button>
            </div>

            <div class="queue-list">
                <div class="queue-item high-priority">
                    <div class="queue-content">
                        <div class="queue-title">6G 기술 동향 분석</div>
                        <div class="queue-meta">
                            <span class="priority-badge high">높음</span>
                            <span>캐릭터: 귀여운 라마</span>
                            <span>예상 시간: 15분</span>
                        </div>
                        <div class="queue-progress">
                            <span>스크립트 검토 완료</span>
                        </div>
                    </div>
                    <div class="queue-actions">
                        <button class="btn-success">제작 시작</button>
                        <button class="btn-secondary">미리보기</button>
                        <button class="btn-warning">우선순위 변경</button>
                    </div>
                </div>

                <div class="queue-item in-progress">
                    <div class="queue-content">
                        <div class="queue-title">위성통신 주파수 정책</div>
                        <div class="queue-meta">
                            <span class="priority-badge medium">보통</span>
                            <span>캐릭터: 똑똑한 로봇</span>
                            <span>진행률: 65%</span>
                        </div>
                        <div class="queue-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                            <span>음성 합성 중...</span>
                        </div>
                    </div>
                    <div class="queue-actions">
                        <button class="btn-secondary">일시정지</button>
                        <button class="btn-primary">모니터링</button>
                        <button class="btn-danger">중지</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Character Selection -->
        <div class="character-management">
            <h3 class="text-xl font-semibold text-white mb-4">캐릭터 설정</h3>
            <div class="character-grid">
                <div class="character-option">
                    <div class="character-avatar">🦙</div>
                    <div class="character-name">귀여운 라마</div>
                    <div class="character-stats">사용률: 45%</div>
                </div>
                <div class="character-option">
                    <div class="character-avatar">🤖</div>
                    <div class="character-name">똑똑한 로봇</div>
                    <div class="character-stats">사용률: 30%</div>
                </div>
                <div class="character-option">
                    <div class="character-avatar">🐱</div>
                    <div class="character-name">호기심 고양이</div>
                    <div class="character-stats">사용률: 15%</div>
                </div>
                <div class="character-option">
                    <div class="character-avatar">🦉</div>
                    <div class="character-name">지혜로운 부엉이</div>
                    <div class="character-stats">사용률: 10%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Users Management Section -->
    <div id="users-section" class="tab-content">
        <div class="section-header">
            <h2 class="text-3xl font-semibold text-white mb-2">사용자 관리</h2>
            <p class="text-muted mb-6">플랫폼 사용자 및 권한 관리</p>
        </div>

        <!-- User Stats -->
        <div class="stats-grid mb-8">
            <div class="stat-card">
                <div class="stat-icon">👥</div>
                <div class="stat-content">
                    <div class="stat-number">127</div>
                    <div class="stat-label">총 사용자</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🟢</div>
                <div class="stat-content">
                    <div class="stat-number">89</div>
                    <div class="stat-label">활성 사용자</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">👨‍💼</div>
                <div class="stat-content">
                    <div class="stat-number">5</div>
                    <div class="stat-label">관리자</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-content">
                    <div class="stat-number">92%</div>
                    <div class="stat-label">이용 만족도</div>
                </div>
            </div>
        </div>

        <!-- User Management Panel -->
        <div class="user-management-panel">
            <div class="panel-header">
                <h3 class="text-xl font-semibold text-white">사용자 목록</h3>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="exportUsers()">
                        📊 내보내기
                    </button>
                    <button class="btn-primary" onclick="openUserModal()">
                        ➕ 사용자 추가
                    </button>
                </div>
            </div>

            <!-- User Filters -->
            <div class="filter-panel mb-6">
                <div class="filter-group">
                    <input type="text" class="search-input" placeholder="사용자 검색...">
                    <select class="filter-select">
                        <option value="">모든 부서</option>
                        <option value="tech">전파기술팀</option>
                        <option value="policy">정책기획팀</option>
                        <option value="research">연구개발팀</option>
                        <option value="admin">관리팀</option>
                    </select>
                    <select class="filter-select">
                        <option value="">모든 권한</option>
                        <option value="admin">관리자</option>
                        <option value="user">일반 사용자</option>
                        <option value="viewer">열람 전용</option>
                    </select>
                    <select class="filter-select">
                        <option value="">모든 상태</option>
                        <option value="active">활성</option>
                        <option value="inactive">비활성</option>
                        <option value="suspended">정지</option>
                    </select>
                </div>
            </div>

            <!-- Users Table -->
            <div class="users-table">
                <table class="table">
                    <thead>
                        <tr>
                            <th>사용자</th>
                            <th>부서</th>
                            <th>권한</th>
                            <th>최근 접속</th>
                            <th>상태</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="user-cell">
                                    <div class="user-avatar-small">김</div>
                                    <div class="user-info">
                                        <div class="user-name">김전파</div>
                                        <div class="user-email">kim@kca.go.kr</div>
                                    </div>
                                </div>
                            </td>
                            <td>전파기술팀</td>
                            <td><span class="role-badge admin">관리자</span></td>
                            <td>2024-01-15 14:30</td>
                            <td><span class="status-badge active">활성</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-edit">수정</button>
                                    <button class="btn-danger">정지</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="user-cell">
                                    <div class="user-avatar-small">이</div>
                                    <div class="user-info">
                                        <div class="user-name">이위성</div>
                                        <div class="user-email">lee@kca.go.kr</div>
                                    </div>
                                </div>
                            </td>
                            <td>정책기획팀</td>
                            <td><span class="role-badge user">사용자</span></td>
                            <td>2024-01-15 11:45</td>
                            <td><span class="status-badge active">활성</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-edit">수정</button>
                                    <button class="btn-secondary">권한 변경</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="user-cell">
                                    <div class="user-avatar-small">박</div>
                                    <div class="user-info">
                                        <div class="user-name">박스펙트럼</div>
                                        <div class="user-email">park@kca.go.kr</div>
                                    </div>
                                </div>
                            </td>
                            <td>연구개발팀</td>
                            <td><span class="role-badge user">사용자</span></td>
                            <td>2024-01-14 16:20</td>
                            <td><span class="status-badge inactive">비활성</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-primary">활성화</button>
                                    <button class="btn-edit">수정</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
/* Base Styles */
.admin-nav {
    display: flex;
    gap: 4px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 4px;
    justify-content: center;
}

.nav-tab {
    padding: 12px 24px;
    background: transparent;
    border: none;
    color: rgb(171, 178, 191);
    font-weight: 500;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.nav-tab:hover {
    background: rgba(255, 255, 255, 0.05);
    color: rgb(255, 255, 255);
}

.nav-tab.active {
    background: rgb(198, 120, 221);
    color: white;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.section-header {
    text-align: center;
    margin-bottom: 40px;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 24px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    transition: all 0.2s ease;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.stat-icon {
    font-size: 2.5rem;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: rgb(198, 120, 221);
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* Control Panel */
.control-panel, .production-panel, .user-management-panel {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
}

.panel-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 24px;
}

.header-actions {
    display: flex;
    gap: 12px;
}

/* Keyword Management */
.keyword-section {
    margin-top: 24px;
}

.keyword-input-group {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
    flex-wrap: wrap;
}

.keyword-input, .category-select, .filter-select, .search-input {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 16px;
    color: white;
    flex: 1;
    min-width: 200px;
}

.keyword-input::placeholder, .search-input::placeholder {
    color: rgb(171, 178, 191);
}

.keyword-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.keyword-tag {
    background: rgb(198, 120, 221);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.remove-tag {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1.2rem;
    line-height: 1;
}

/* Jobs Grid */
.jobs-grid, .articles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 24px;
}

.job-card, .article-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s ease;
}

.job-card:hover, .article-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.job-header, .article-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.job-title, .article-title {
    font-weight: 600;
    color: white;
    font-size: 1.1rem;
}

.job-status, .article-status {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.job-status.running, .article-status.summarized {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
}

.job-status.scheduled, .article-status.pending {
    background: rgba(229, 192, 123, 0.2);
    color: rgb(229, 192, 123);
}

.job-details, .article-meta {
    margin-bottom: 16px;
}

.job-meta, .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.article-category {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
}

.article-category.technology {
    background: rgba(198, 120, 221, 0.2);
    color: rgb(198, 120, 221);
}

.article-category.policy {
    background: rgba(86, 182, 194, 0.2);
    color: rgb(86, 182, 194);
}

.progress-bar {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    height: 8px;
    overflow: hidden;
    flex: 1;
}

.progress-fill {
    background: linear-gradient(90deg, rgb(198, 120, 221), rgb(86, 182, 194));
    height: 100%;
    border-radius: 4px;
    transition: width 0.3s ease;
}

.job-progress {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.job-actions, .article-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

/* Buttons */
.btn-primary, .btn-secondary, .btn-success, .btn-warning, .btn-danger, .btn-add-keyword, .btn-filter, .btn-edit {
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.btn-primary {
    background: rgb(198, 120, 221);
    color: white;
}

.btn-primary:hover {
    background: rgb(178, 100, 201);
    transform: translateY(-1px);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: rgb(171, 178, 191);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.15);
    color: white;
}

.btn-success {
    background: rgb(152, 195, 121);
    color: white;
}

.btn-warning {
    background: rgb(229, 192, 123);
    color: white;
}

.btn-danger {
    background: rgb(224, 108, 117);
    color: white;
}

.btn-add-keyword, .btn-filter {
    background: rgb(86, 182, 194);
    color: white;
}

/* Article Summary */
.article-summary {
    background: rgba(198, 120, 221, 0.1);
    border: 1px solid rgba(198, 120, 221, 0.2);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 16px;
}

.article-summary h5 {
    color: rgb(198, 120, 221);
    margin-bottom: 8px;
    font-size: 0.9rem;
}

.article-summary p {
    color: rgb(171, 178, 191);
    line-height: 1.5;
}

/* Queue Items */
.queue-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.queue-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.queue-item.high-priority {
    border-left: 4px solid rgb(224, 108, 117);
}

.queue-item.in-progress {
    border-left: 4px solid rgb(152, 195, 121);
}

.queue-content {
    flex: 1;
}

.queue-title {
    font-weight: 600;
    color: white;
    margin-bottom: 8px;
}

.queue-meta {
    display: flex;
    gap: 16px;
    margin-bottom: 8px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.priority-badge {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.priority-badge.high {
    background: rgba(224, 108, 117, 0.2);
    color: rgb(224, 108, 117);
}

.priority-badge.medium {
    background: rgba(229, 192, 123, 0.2);
    color: rgb(229, 192, 123);
}

.queue-actions {
    display: flex;
    gap: 8px;
}

/* Character Grid */
.character-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

.character-option {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.2s ease;
    cursor: pointer;
}

.character-option:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.character-avatar {
    font-size: 3rem;
    margin-bottom: 12px;
}

.character-name {
    font-weight: 600;
    color: white;
    margin-bottom: 4px;
}

.character-stats {
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

/* Filter Panel */
.filter-panel {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 20px;
}

.filter-group {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
}

.filter-date {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 16px;
    color: white;
}

/* Users Table */
.users-table {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    overflow: hidden;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th {
    background: rgba(255, 255, 255, 0.05);
    padding: 16px;
    text-align: left;
    font-weight: 600;
    color: white;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.table td {
    padding: 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: rgb(171, 178, 191);
}

.user-cell {
    display: flex;
    align-items: center;
    gap: 12px;
}

.user-avatar-small {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
}

.user-name {
    font-weight: 600;
    color: white;
}

.user-email {
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.role-badge, .status-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.role-badge.admin {
    background: rgba(224, 108, 117, 0.2);
    color: rgb(224, 108, 117);
}

.role-badge.user {
    background: rgba(86, 182, 194, 0.2);
    color: rgb(86, 182, 194);
}

.status-badge.active {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
}

.status-badge.inactive {
    background: rgba(171, 178, 191, 0.2);
    color: rgb(171, 178, 191);
}

.action-buttons {
    display: flex;
    gap: 8px;
}

/* User Info Admin Style */
.user-avatar.admin {
    background: linear-gradient(135deg, rgb(224, 108, 117), rgb(229, 192, 123));
}

.icon-crown {
    font-size: 1.5rem;
}

/* Crawling Form Styles */
.crawling-form {
    margin-top: 24px;
}

.crawling-input-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.input-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.input-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    font-weight: 500;
}

.crawling-status {
    background: rgba(86, 182, 194, 0.1);
    border: 1px solid rgba(86, 182, 194, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
}

.status-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.status-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.status-indicator {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-indicator.running {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
    animation: pulse 2s infinite;
}

.progress-container {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.status-details {
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Crawling Results Styles */
.crawling-results {
    background: rgba(198, 120, 221, 0.1);
    border: 1px solid rgba(198, 120, 221, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.results-meta {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.articles-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 20px;
    max-height: 400px;
    overflow-y: auto;
}

.article-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 16px;
    transition: all 0.2s ease;
}

.article-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateX(4px);
}

.article-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
    gap: 12px;
}

.article-item-title {
    font-weight: 600;
    color: white;
    font-size: 1rem;
    line-height: 1.4;
    flex: 1;
}

.article-item-category {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
    flex-shrink: 0;
}

.article-item-category.technology {
    background: rgba(198, 120, 221, 0.2);
    color: rgb(198, 120, 221);
}

.article-item-category.industry {
    background: rgba(86, 182, 194, 0.2);
    color: rgb(86, 182, 194);
}

.article-item-category.policy {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
}

.article-item-summary {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 8px;
}

.article-item-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: rgb(156, 163, 175);
}

.article-item-source {
    font-weight: 500;
}

.article-item-url {
    color: rgb(86, 182, 194);
    text-decoration: none;
    font-size: 0.8rem;
}

.article-item-url:hover {
    text-decoration: underline;
}

.results-actions {
    display: flex;
    justify-content: center;
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.hidden {
    display: none;
}

/* Responsive */
@media (max-width: 768px) {
    .admin-nav {
        flex-direction: column;
    }
    
    .nav-tab {
        text-align: center;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .jobs-grid, .articles-grid {
        grid-template-columns: 1fr;
    }
    
    .keyword-input-group {
        flex-direction: column;
    }
    
    .queue-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
    
    .filter-group {
        flex-direction: column;
        align-items: stretch;
    }
    
    .table {
        font-size: 0.9rem;
    }
    
    .panel-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
    }
}
</style>

<script>
let currentTab = 'crawling';

function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabName + '-section').classList.add('active');
    
    // Add active class to selected tab
    event.target.classList.add('active');
    
    currentTab = tabName;
}

// 크롤링 기능
function startCrawling() {
    const keyword = document.getElementById('crawl-keyword').value.trim();
    const category = document.getElementById('crawl-category').value;
    
    if (!keyword) {
        alert('크롤링할 키워드를 입력해주세요.');
        return;
    }
    
    // 크롤링 상태 표시
    const statusDiv = document.getElementById('crawling-status');
    const resultsDiv = document.getElementById('crawling-results');
    
    statusDiv.classList.remove('hidden');
    resultsDiv.classList.add('hidden');
    
    // 진행률 초기화
    updateProgress(0, '크롤링을 시작합니다...');
    
    // 실제 크롤링 API 호출
    fetch('/api/crawl', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            keyword: keyword,
            category: category
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // 크롤링 완료
            updateProgress(100, '크롤링이 완료되었습니다.');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
                displayCrawlingResults(data.data);
            }, 1000);
        } else {
            throw new Error(data.message || '크롤링에 실패했습니다.');
        }
    })
    .catch(error => {
        console.error('크롤링 오류:', error);
        updateProgress(0, '크롤링 중 오류가 발생했습니다: ' + error.message);
        
        // 에러 상태 표시
        const statusIndicator = document.querySelector('.status-indicator');
        statusIndicator.textContent = '실패';
        statusIndicator.className = 'status-indicator error';
        statusIndicator.style.background = 'rgba(224, 108, 117, 0.2)';
        statusIndicator.style.color = 'rgb(224, 108, 117)';
    });
    
    // 진행률 시뮬레이션 (실제 크롤링이 완료되기 전까지)
    simulateProgress();
}

function simulateProgress() {
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90; // 90%에서 정지
        
        const messages = [
            '네이버 뉴스 페이지에 접속 중...',
            '검색 결과를 분석 중...',
            '기사 정보를 추출 중...',
            '데이터를 정리하고 있습니다...'
        ];
        
        const messageIndex = Math.floor(progress / 25);
        const message = messages[messageIndex] || messages[messages.length - 1];
        
        updateProgress(progress, message);
        
        if (progress >= 90) {
            clearInterval(interval);
        }
    }, 500);
}

function updateProgress(percentage, message) {
    const progressFill = document.getElementById('crawl-progress');
    const progressText = document.getElementById('progress-text');
    const detailsText = document.getElementById('crawl-details');
    
    progressFill.style.width = percentage + '%';
    progressText.textContent = Math.round(percentage) + '%';
    detailsText.textContent = message;
}

function displayCrawlingResults(data) {
    const resultsDiv = document.getElementById('crawling-results');
    const articlesList = document.getElementById('articles-list');
    const resultsCount = document.getElementById('results-count');
    const resultsTime = document.getElementById('results-time');
    
    // 결과 메타데이터 업데이트
    resultsCount.textContent = `${data.articles.length}개 기사 수집`;
    resultsTime.textContent = data.crawl_time;
    
    // 기사 목록 생성
    articlesList.innerHTML = '';
    data.articles.forEach(article => {
        const articleDiv = document.createElement('div');
        articleDiv.className = 'article-item';
        
        articleDiv.innerHTML = `
            <div class="article-item-header">
                <div class="article-item-title">${article.title}</div>
                <div class="article-item-category ${article.category || 'technology'}">${getCategoryName(article.category)}</div>
            </div>
            <div class="article-item-summary">${article.summary}</div>
            <div class="article-item-meta">
                <div>
                    <span class="article-item-source">${article.source}</span>
                    <span class="article-item-date"> • ${article.date}</span>
                </div>
                <a href="${article.url}" target="_blank" class="article-item-url">원문 보기 →</a>
            </div>
        `;
        
        articlesList.appendChild(articleDiv);
    });
    
    // 결과 표시
    resultsDiv.classList.remove('hidden');
}

function getCategoryName(category) {
    const categories = {
        'technology': '기술',
        'policy': '정책',
        'industry': '산업',
        'research': '연구'
    };
    return categories[category] || '기술';
}

function clearResults() {
    const resultsDiv = document.getElementById('crawling-results');
    const statusDiv = document.getElementById('crawling-status');
    
    resultsDiv.classList.add('hidden');
    statusDiv.classList.add('hidden');
    
    // 폼 초기화
    document.getElementById('crawl-keyword').value = 'ai';
}

function exportResults() {
    const articles = document.querySelectorAll('.article-item');
    if (articles.length === 0) {
        alert('내보낼 결과가 없습니다.');
        return;
    }
    
    // 실제 구현시에는 CSV나 Excel로 내보내기
    alert(`${articles.length}개 기사 결과를 내보내는 기능입니다. (실제 구현 필요)`);
}

function openCrawlingModal() {
    alert('크롤링 작업 생성 모달을 열어야 합니다. (백엔드 구현 필요)');
}

function openVideoModal() {
    alert('영상 제작 모달을 열어야 합니다. (백엔드 구현 필요)');
}

function openUserModal() {
    alert('사용자 추가 모달을 열어야 합니다. (백엔드 구현 필요)');
}

function exportUsers() {
    alert('사용자 데이터 내보내기 기능입니다. (백엔드 구현 필요)');
}

// Load page with proper tab activation
document.addEventListener('DOMContentLoaded', function() {
    // Initialize first tab as active
    document.querySelector('.nav-tab').classList.add('active');
    document.querySelector('.tab-content').classList.add('active');
});
</script>
{% endblock %}