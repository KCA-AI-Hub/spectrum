{% extends "base.html" %}

{% block title %}전파 동향조사 브리핑 - 로그인{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center px-4">
    <div class="login-container">
        <div class="logo-section text-center mb-10">
            <span class="text-6xl block mb-5">📡</span>
            <h1 class="text-4xl font-semibold text-white mb-3">전파 동향조사 브리핑</h1>
            <p class="text-muted text-lg">회사 사번으로 로그인하여<br>전파 기술 동향을 학습하세요</p>
        </div>

        <form class="space-y-6" id="loginForm">
            <div>
                <label for="employeeId" class="block text-sm font-medium text-white mb-2">사번</label>
                <input 
                    type="text" 
                    id="employeeId" 
                    name="employee_id"
                    class="w-full px-5 py-4 rounded-xl bg-white/5 border border-white/10 text-white placeholder-muted focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                    placeholder="사번을 입력하세요 (예: 2024001)"
                    maxlength="10"
                    required
                >
                <div class="error-message text-danger text-sm mt-2 hidden">올바른 사번 형식을 입력해주세요</div>
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-white mb-2">비밀번호</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password"
                    class="w-full px-5 py-4 rounded-xl bg-white/5 border border-white/10 text-white placeholder-muted focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all"
                    placeholder="비밀번호를 입력하세요"
                    required
                >
                <div class="error-message text-danger text-sm mt-2 hidden">비밀번호를 입력해주세요</div>
            </div>

            <button type="submit" class="w-full bg-primary text-white py-4 rounded-xl font-semibold text-lg hover:bg-accent transform hover:-translate-y-0.5 transition-all shadow-lg hover:shadow-xl" id="loginBtn">
                <span class="flex items-center justify-center">
                    로그인
                    <span class="loading hidden ml-3">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </span>
                </span>
            </button>
        </form>

        <div class="text-center mt-6">
            <a href="#" class="text-primary hover:text-accent transition-colors" onclick="showForgotPassword()">비밀번호를 잊으셨나요?</a>
        </div>

        <div class="demo-login mt-8 pt-8 border-t border-white/10">
            <p class="text-muted text-center mb-4">데모 버전으로 체험해보기</p>
            <button class="w-full bg-success/20 text-success border border-success/30 py-3 rounded-xl font-medium hover:bg-success/30 transition-all" onclick="demoLogin()">
                데모 로그인
            </button>
        </div>
    </div>
</div>

<style>
    .login-container {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 50px;
        backdrop-filter: blur(20px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 450px;
    }
    
    .error-message.show {
        display: block !important;
    }
    
    .loading.show {
        display: inline-block !important;
    }
    
    input.error {
        border-color: rgb(224, 108, 117) !important;
        background: rgba(224, 108, 117, 0.1) !important;
    }
</style>

<script>
    // 로그인 폼 처리
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        handleLogin();
    });

    // 로그인 처리
    function handleLogin() {
        const employeeId = document.getElementById('employeeId').value;
        const password = document.getElementById('password').value;
        
        // 로딩 상태 표시
        const loginBtn = document.getElementById('loginBtn');
        const loading = loginBtn.querySelector('.loading');
        loginBtn.disabled = true;
        loading.classList.add('show');
        
        // 서버로 로그인 요청
        fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `employee_id=${encodeURIComponent(employeeId)}&password=${encodeURIComponent(password)}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = '/dashboard';
            } else {
                alert(data.message || '로그인에 실패했습니다.');
                loginBtn.disabled = false;
                loading.classList.remove('show');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('로그인 중 오류가 발생했습니다.');
            loginBtn.disabled = false;
            loading.classList.remove('show');
        });
    }

    // 데모 로그인
    function demoLogin() {
        document.getElementById('employeeId').value = '2024001';
        document.getElementById('password').value = 'password';
        handleLogin();
    }

    // 비밀번호 찾기
    function showForgotPassword() {
        alert('비밀번호 찾기는 시스템 관리자에게 문의하세요.\n\n연락처: admin@company.com\n전화: 02-1234-5678');
    }
</script>
{% endblock %}