{% extends "base.html" %}

{% block title %}통합 관리자 대시보드 - spectrum 크롤링 비디오 생성 플랫폼{% endblock %}

{% block content %}
<div class="admin-dashboard-container">
    <!-- 사용자 정보 -->
    <div class="user-info-bar">
        <div class="user-info">
            <div class="user-avatar admin">
                <i class="icon-crown">👑</i>
            </div>
            <div class="user-details">
                <div class="user-name">관리자</div>
                <div class="user-role">시스템 관리</div>
            </div>
            <a href="{{ url_for('logout') }}" class="logout-btn">로그아웃</a>
        </div>
    </div>

    <!-- 헤더 -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">크롤링 관리 대시보드</h1>
        <p class="dashboard-subtitle">Firecrawl API 기반 정책동향 분석 시스템</p>
    </div>

    <!-- 통계 개요 섹션 -->
    <div class="stats-overview-section">
        <div class="section-header">
            <h2 class="section-title">크롤링 현황</h2>
            <div class="section-actions">
                <button class="btn-refresh-stats" onclick="refreshAllStats()">
                    <i class="icon">🔄</i> 새로고침
                </button>
            </div>
        </div>
        <div class="stats-grid" id="dashboard-stats-grid">
            <!-- 통계 카드들이 동적으로 생성됩니다 -->
        </div>
        <div class="last-updated">
            마지막 업데이트: <span id="stats-last-updated">-</span>
        </div>
    </div>

    <!-- 크롤링 실행 컨트롤 섹션 -->
    <div class="crawling-control-section">
        <div class="section-header">
            <h2 class="section-title">주간 크롤링 실행</h2>
            <div class="crawling-status-indicator" id="crawling-status-indicator">
                <span class="status-dot idle"></span>
                <span class="status-text">대기중</span>
            </div>
        </div>

        <!-- 크롤링 설정 요약 -->
        <div class="crawling-summary-card">
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-icon">🏷️</div>
                    <div class="summary-content">
                        <div class="summary-value" id="total-keywords">0</div>
                        <div class="summary-label">등록된 키워드</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">🌐</div>
                    <div class="summary-content">
                        <div class="summary-value" id="total-sites">0</div>
                        <div class="summary-label">대상 사이트</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">⏱️</div>
                    <div class="summary-content">
                        <div class="summary-value" id="estimated-duration">15-20분</div>
                        <div class="summary-label">예상 소요시간</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">📅</div>
                    <div class="summary-content">
                        <div class="summary-value" id="last-crawl-date">미실행</div>
                        <div class="summary-label">마지막 실행</div>
                    </div>
                </div>
            </div>
            
            <!-- 주간 크롤링 실행 버튼 -->
            <div class="main-action">
                <button class="btn-start-weekly-crawling" id="start-weekly-crawling-btn" onclick="startWeeklyCrawling()">
                    <i class="icon">🚀</i>
                    <span class="btn-text">주간 크롤링 시작</span>
                </button>
            </div>
        </div>

        <!-- 크롤링 진행 상황 (숨김 상태) -->
        <div class="crawling-progress-card hidden" id="crawling-progress-card">
            <div class="progress-header">
                <h3 class="progress-title">크롤링 진행 상황</h3>
                <div class="progress-meta">
                    <span class="elapsed-time" id="elapsed-time">00:00</span>
                    <span class="current-status" id="current-status">준비중...</span>
                </div>
            </div>
            
            <div class="overall-progress">
                <div class="progress-info">
                    <span class="progress-label">전체 진행률</span>
                    <span class="progress-percentage" id="overall-percentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overall-progress-fill"></div>
                </div>
            </div>

            <div class="detailed-progress">
                <div class="progress-stats">
                    <div class="progress-stat">
                        <span class="stat-label">처리된 사이트</span>
                        <span class="stat-value"><span id="processed-sites">0</span>/<span id="total-sites-progress">0</span></span>
                    </div>
                    <div class="progress-stat">
                        <span class="stat-label">수집된 기사</span>
                        <span class="stat-value" id="collected-articles">0</span>
                    </div>
                    <div class="progress-stat">
                        <span class="stat-label">성공률</span>
                        <span class="stat-value" id="success-rate">0%</span>
                    </div>
                </div>
            </div>

            <div class="crawling-controls">
                <button class="btn-pause" id="pause-btn" onclick="pauseCrawling()">
                    <i class="icon">⏸️</i> 일시정지
                </button>
                <button class="btn-stop" id="stop-btn" onclick="stopCrawling()">
                    <i class="icon">⏹️</i> 중지
                </button>
            </div>
        </div>
    </div>

    <!-- 설정 관리 섹션 -->
    <div class="settings-section">
        <div class="settings-tabs">
            <button class="settings-tab active" onclick="switchSettingsTab('keywords')">
                🏷️ 키워드 관리
            </button>
            <button class="settings-tab" onclick="switchSettingsTab('sites')">
                🌐 사이트 관리
            </button>
        </div>

        <!-- 키워드 관리 탭 -->
        <div class="settings-content active" id="keywords-settings">
            <div class="settings-header">
                <h3 class="settings-title">크롤링 키워드 설정</h3>
                <div class="keyword-count-badge" id="keyword-count-badge">0개</div>
            </div>
            
            <div class="keyword-input-section">
                <div class="keyword-input-group">
                    <input type="text" 
                           id="keyword-input" 
                           class="keyword-input" 
                           placeholder="키워드 입력 (예: 전파, 주파수, 6G)"
                           maxlength="50">
                    <select id="keyword-category" class="category-select">
                        <option value="technology">기술</option>
                        <option value="policy">정책</option>
                        <option value="industry">산업</option>
                        <option value="research">연구</option>
                    </select>
                    <button type="button" class="btn-add-keyword" onclick="addKeyword()">
                        <i class="icon">➕</i> 추가
                    </button>
                </div>
            </div>

            <div class="keyword-tags-container">
                <div class="keyword-tags" id="keyword-tags">
                    <!-- 키워드 태그들이 동적으로 생성됩니다 -->
                </div>
                <div class="empty-state" id="keywords-empty-state">
                    <div class="empty-icon">🏷️</div>
                    <div class="empty-text">등록된 키워드가 없습니다.</div>
                    <div class="empty-subtext">위에서 키워드를 추가해보세요.</div>
                </div>
            </div>

            <div class="keyword-filters">
                <div class="filter-label">카테고리별 보기:</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-category="all" onclick="filterKeywords('all')">전체</button>
                    <button class="filter-btn" data-category="technology" onclick="filterKeywords('technology')">기술</button>
                    <button class="filter-btn" data-category="policy" onclick="filterKeywords('policy')">정책</button>
                    <button class="filter-btn" data-category="industry" onclick="filterKeywords('industry')">산업</button>
                    <button class="filter-btn" data-category="research" onclick="filterKeywords('research')">연구</button>
                </div>
            </div>
        </div>

        <!-- 사이트 관리 탭 -->
        <div class="settings-content" id="sites-settings">
            <div class="settings-header">
                <h3 class="settings-title">크롤링 대상 사이트 관리</h3>
                <div class="settings-actions">
                    <button class="btn-download-template" onclick="downloadTemplate()">
                        <i class="icon">📋</i> 템플릿 다운로드
                    </button>
                    <button class="btn-add-site" onclick="openAddSiteModal()">
                        <i class="icon">➕</i> 수동 추가
                    </button>
                </div>
            </div>

            <!-- Excel 파일 업로드 -->
            <div class="file-upload-area" id="file-upload-area">
                <div class="upload-content">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">
                        <div class="upload-title">Excel 파일을 드래그하여 업로드</div>
                        <div class="upload-subtitle">또는 클릭하여 파일 선택</div>
                    </div>
                    <div class="upload-formats">지원 형식: .xlsx, .xls (최대 10MB)</div>
                </div>
                <input type="file" id="site-file-input" accept=".xlsx,.xls" class="file-input">
            </div>

            <!-- 사이트 필터 -->
            <div class="site-filters">
                <select class="filter-select" id="site-type-filter" onchange="filterSites()">
                    <option value="">모든 타입</option>
                    <option value="government">정부기관</option>
                    <option value="news">언론사</option>
                    <option value="tech">기술블로그</option>
                    <option value="research">연구기관</option>
                </select>
                <select class="filter-select" id="site-status-filter" onchange="filterSites()">
                    <option value="">모든 상태</option>
                    <option value="active">활성</option>
                    <option value="inactive">비활성</option>
                    <option value="error">오류</option>
                </select>
                <input type="text" class="search-input" id="site-search" placeholder="사이트명 또는 URL 검색..." oninput="filterSites()">
            </div>

            <!-- 사이트 목록 -->
            <div class="sites-grid" id="sites-grid">
                <!-- 사이트 카드들이 동적으로 생성됩니다 -->
            </div>

            <div class="empty-state" id="sites-empty-state">
                <div class="empty-icon">🌐</div>
                <div class="empty-text">등록된 사이트가 없습니다.</div>
                <div class="empty-subtext">Excel 파일을 업로드하거나 수동으로 사이트를 추가해보세요.</div>
            </div>
        </div>
    </div>

    <!-- 최근 크롤링 결과 섹션 -->
    <div class="recent-results-section">
        <div class="section-header">
            <h2 class="section-title">최근 크롤링 결과</h2>
            <button class="btn-view-all" onclick="viewAllResults()">
                전체 보기
            </button>
        </div>
        <div class="results-preview" id="results-preview">
            <!-- 최근 크롤링 결과가 동적으로 생성됩니다 -->
        </div>
    </div>
</div>

<!-- 수동 사이트 추가 모달 -->
<div class="modal hidden" id="add-site-modal">
    <div class="modal-overlay" onclick="closeAddSiteModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">사이트 수동 추가</h3>
            <button class="modal-close" onclick="closeAddSiteModal()">✕</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">사이트명 *</label>
                <input type="text" id="manual-site-name" class="form-input" placeholder="예: 한국방송통신위원회">
            </div>
            <div class="form-group">
                <label class="form-label">URL *</label>
                <input type="url" id="manual-site-url" class="form-input" placeholder="https://www.kca.go.kr">
            </div>
            <div class="form-group">
                <label class="form-label">사이트 타입</label>
                <select id="manual-site-type" class="form-select">
                    <option value="government">정부기관</option>
                    <option value="news">언론사</option>
                    <option value="tech">기술블로그</option>
                    <option value="research">연구기관</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">설명</label>
                <textarea id="manual-site-description" class="form-textarea" placeholder="사이트에 대한 간단한 설명"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeAddSiteModal()">취소</button>
            <button class="btn-primary" onclick="addSiteManually()">추가</button>
        </div>
    </div>
</div>

<style>
/* 통합 관리자 대시보드 스타일 */
.admin-dashboard-container {
    min-height: 100vh;
    background: linear-gradient(135deg, rgb(15, 23, 42) 0%, rgb(30, 41, 59) 100%);
    padding: 20px;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* 사용자 정보 바 */
.user-info-bar {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 100;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 12px 16px;
}

.user-avatar.admin {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, rgb(224, 108, 117), rgb(229, 192, 123));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.user-details {
    text-align: right;
}

.user-name {
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
}

.user-role {
    color: rgb(171, 178, 191);
    font-size: 0.8rem;
}

.logout-btn {
    background: rgba(224, 108, 117, 0.2);
    border: 1px solid rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.8rem;
    transition: all 0.2s ease;
}

.logout-btn:hover {
    background: rgba(224, 108, 117, 0.3);
}

/* 대시보드 헤더 */
.dashboard-header {
    text-align: center;
    margin: 60px 0 40px;
}

.dashboard-title {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 12px;
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.dashboard-subtitle {
    color: rgb(171, 178, 191);
    font-size: 1.1rem;
}

/* 섹션 공통 스타일 */
.stats-overview-section,
.crawling-control-section,
.settings-section,
.recent-results-section {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.section-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 600;
}

.section-actions {
    display: flex;
    gap: 12px;
}

/* 통계 그리드 */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 16px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.stat-card.primary { border-left: 4px solid rgb(198, 120, 221); }
.stat-card.secondary { border-left: 4px solid rgb(86, 182, 194); }
.stat-card.success { border-left: 4px solid rgb(152, 195, 121); }
.stat-card.warning { border-left: 4px solid rgb(229, 192, 123); }
.stat-card.danger { border-left: 4px solid rgb(224, 108, 117); }

.stat-icon {
    font-size: 3rem;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.stat-card.primary .stat-icon { background: rgba(198, 120, 221, 0.2); color: rgb(198, 120, 221); }
.stat-card.secondary .stat-icon { background: rgba(86, 182, 194, 0.2); color: rgb(86, 182, 194); }
.stat-card.success .stat-icon { background: rgba(152, 195, 121, 0.2); color: rgb(152, 195, 121); }
.stat-card.warning .stat-icon { background: rgba(229, 192, 123, 0.2); color: rgb(229, 192, 123); }
.stat-card.danger .stat-icon { background: rgba(224, 108, 117, 0.2); color: rgb(224, 108, 117); }

.stat-content {
    flex: 1;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 4px;
    line-height: 1;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.stat-change {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85rem;
    font-weight: 500;
}

.stat-change.positive { color: rgb(152, 195, 121); }
.stat-change.negative { color: rgb(224, 108, 117); }
.stat-change.neutral { color: rgb(171, 178, 191); }

.last-updated {
    text-align: center;
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* 크롤링 상태 표시기 */
.crawling-status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-dot.idle { background: rgb(171, 178, 191); animation: none; }
.status-dot.running { background: rgb(152, 195, 121); }
.status-dot.paused { background: rgb(229, 192, 123); }
.status-dot.completed { background: rgb(86, 182, 194); }
.status-dot.error { background: rgb(224, 108, 117); }

.status-text {
    color: white;
    font-size: 0.9rem;
    font-weight: 500;
}

/* 크롤링 요약 카드 */
.crawling-summary-card {
    background: rgba(198, 120, 221, 0.1);
    border: 1px solid rgba(198, 120, 221, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.summary-icon {
    font-size: 2rem;
    color: rgb(198, 120, 221);
}

.summary-value {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 4px;
}

.summary-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* 주간 크롤링 실행 버튼 */
.main-action {
    text-align: center;
}

.btn-start-weekly-crawling {
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    color: white;
    border: none;
    border-radius: 16px;
    padding: 20px 40px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
    box-shadow: 0 8px 24px rgba(198, 120, 221, 0.3);
}

.btn-start-weekly-crawling:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(198, 120, 221, 0.4);
}

.btn-start-weekly-crawling:disabled {
    background: rgba(171, 178, 191, 0.3);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.btn-start-weekly-crawling .icon {
    font-size: 1.4rem;
}

/* 크롤링 진행 카드 */
.crawling-progress-card {
    background: rgba(86, 182, 194, 0.1);
    border: 1px solid rgba(86, 182, 194, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-top: 24px;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.progress-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.progress-meta {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.elapsed-time {
    font-family: monospace;
    color: rgb(86, 182, 194);
}

.overall-progress {
    margin-bottom: 20px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-label {
    color: white;
    font-weight: 500;
}

.progress-percentage {
    color: rgb(86, 182, 194);
    font-weight: 600;
    font-size: 1.1rem;
}

.progress-bar {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    height: 12px;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, rgb(86, 182, 194), rgb(198, 120, 221));
    height: 100%;
    width: 0%;
    border-radius: 8px;
    transition: width 0.5s ease;
}

.detailed-progress {
    margin-bottom: 20px;
}

.progress-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
}

.progress-stat {
    text-align: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.stat-value {
    color: white;
    font-weight: 600;
    font-size: 1rem;
}

.crawling-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.btn-pause, .btn-stop {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgb(171, 178, 191);
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-pause:hover {
    background: rgba(229, 192, 123, 0.2);
    border-color: rgba(229, 192, 123, 0.3);
    color: rgb(229, 192, 123);
}

.btn-stop:hover {
    background: rgba(224, 108, 117, 0.2);
    border-color: rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
}

/* 설정 탭 */
.settings-tabs {
    display: flex;
    gap: 4px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 24px;
}

.settings-tab {
    padding: 12px 24px;
    background: transparent;
    border: none;
    color: rgb(171, 178, 191);
    font-weight: 500;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.settings-tab:hover {
    background: rgba(255, 255, 255, 0.05);
    color: white;
}

.settings-tab.active {
    background: rgb(198, 120, 221);
    color: white;
}

.settings-content {
    display: none;
}

.settings-content.active {
    display: block;
}

.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.settings-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.settings-actions {
    display: flex;
    gap: 8px;
}

.keyword-count-badge {
    background: rgba(198, 120, 221, 0.2);
    color: rgb(198, 120, 221);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 500;
}

/* 키워드 입력 */
.keyword-input-section {
    margin-bottom: 24px;
}

.keyword-input-group {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
}

.keyword-input {
    flex: 1;
    min-width: 250px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 16px;
    color: white;
    font-size: 0.95rem;
}

.keyword-input:focus {
    outline: none;
    border-color: rgb(198, 120, 221);
    background: rgba(255, 255, 255, 0.08);
}

.keyword-input::placeholder {
    color: rgb(171, 178, 191);
}

.category-select {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 16px;
    color: white;
    min-width: 120px;
}

.btn-add-keyword {
    background: rgb(198, 120, 221);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-add-keyword:hover {
    background: rgb(178, 100, 201);
    transform: translateY(-1px);
}

/* 키워드 태그 */
.keyword-tags-container {
    margin-bottom: 24px;
}

.keyword-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 40px;
}

.keyword-tag {
    background: rgba(198, 120, 221, 0.2);
    border: 1px solid rgba(198, 120, 221, 0.3);
    color: rgb(198, 120, 221);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.keyword-tag:hover {
    background: rgba(198, 120, 221, 0.3);
    transform: translateY(-1px);
}

.keyword-tag.technology { background: rgba(198, 120, 221, 0.2); border-color: rgba(198, 120, 221, 0.3); color: rgb(198, 120, 221); }
.keyword-tag.policy { background: rgba(86, 182, 194, 0.2); border-color: rgba(86, 182, 194, 0.3); color: rgb(86, 182, 194); }
.keyword-tag.industry { background: rgba(152, 195, 121, 0.2); border-color: rgba(152, 195, 121, 0.3); color: rgb(152, 195, 121); }
.keyword-tag.research { background: rgba(229, 192, 123, 0.2); border-color: rgba(229, 192, 123, 0.3); color: rgb(229, 192, 123); }

.remove-keyword {
    background: none;
    border: none;
    color: currentColor;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.remove-keyword:hover {
    opacity: 1;
}

.keyword-filters {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 16px;
}

.filter-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 8px;
}

.filter-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.filter-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgb(171, 178, 191);
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background: rgba(255, 255, 255, 0.08);
    color: white;
}

.filter-btn.active {
    background: rgb(198, 120, 221);
    border-color: rgb(198, 120, 221);
    color: white;
}

/* 파일 업로드 */
.file-upload-area {
    border: 2px dashed rgba(198, 120, 221, 0.3);
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    background: rgba(198, 120, 221, 0.05);
    margin-bottom: 24px;
}

.file-upload-area:hover {
    border-color: rgba(198, 120, 221, 0.5);
    background: rgba(198, 120, 221, 0.08);
}

.file-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 16px;
}

.upload-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.upload-subtitle {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 16px;
}

.upload-formats {
    color: rgb(156, 163, 175);
    font-size: 0.8rem;
}

/* 사이트 필터 */
.site-filters {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.filter-select, .search-input {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 8px 12px;
    color: white;
    font-size: 0.9rem;
}

.filter-select {
    min-width: 120px;
}

.search-input {
    flex: 1;
    min-width: 200px;
}

.search-input::placeholder {
    color: rgb(171, 178, 191);
}

/* 사이트 그리드 */
.sites-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 16px;
}

.site-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s ease;
}

.site-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

/* 빈 상태 */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: rgb(171, 178, 191);
}

.empty-state.hidden {
    display: none;
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-text {
    font-size: 1.1rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.empty-subtext {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* 최근 결과 */
.results-preview {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
}

/* 버튼 스타일 */
.btn-refresh-stats, .btn-download-template, .btn-add-site, .btn-view-all {
    background: rgba(86, 182, 194, 0.2);
    border: 1px solid rgba(86, 182, 194, 0.3);
    color: rgb(86, 182, 194);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    text-decoration: none;
}

.btn-refresh-stats:hover, .btn-download-template:hover, .btn-add-site:hover, .btn-view-all:hover {
    background: rgba(86, 182, 194, 0.3);
    transform: translateY(-1px);
}

/* 모달 */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal.hidden {
    display: none;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
}

.modal-content {
    background: rgb(31, 35, 40);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    z-index: 1;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-title {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    color: rgb(171, 178, 191);
    font-size: 1.5rem;
    cursor: pointer;
}

.modal-body {
    padding: 24px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    color: white;
    font-weight: 500;
    margin-bottom: 8px;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 10px 12px;
    color: white;
    font-size: 0.9rem;
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.modal-footer {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    padding: 20px 24px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgb(171, 178, 191);
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
}

.btn-primary {
    background: rgb(198, 120, 221);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
}

/* 유틸리티 */
.hidden {
    display: none !important;
}

/* 애니메이션 */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* 반응형 */
@media (max-width: 768px) {
    .dashboard-title {
        font-size: 2rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .summary-grid {
        grid-template-columns: 1fr;
    }
    
    .keyword-input-group {
        flex-direction: column;
    }
    
    .site-filters {
        flex-direction: column;
    }
    
    .sites-grid {
        grid-template-columns: 1fr;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    
    .settings-tabs {
        flex-direction: column;
    }
}
</style>

<script>
// 통합 관리자 대시보드 JavaScript
class IntegratedDashboard {
    constructor() {
        this.keywords = [];
        this.sites = [];
        this.isRunning = false;
        this.currentFilter = 'all';
        this.crawlingJob = null;
        this.init();
    }

    init() {
        this.loadInitialData();
        this.setupEventListeners();
        this.updateAllCounts();
        this.loadStats();
    }

    setupEventListeners() {
        // Enter 키로 키워드 추가
        const keywordInput = document.getElementById('keyword-input');
        keywordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.addKeyword();
            }
        });

        // 파일 업로드 설정
        this.setupFileUpload();
    }

    setupFileUpload() {
        const uploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('site-file-input');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgb(198, 120, 221)';
            uploadArea.style.background = 'rgba(198, 120, 221, 0.1)';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgba(198, 120, 221, 0.3)';
            uploadArea.style.background = 'rgba(198, 120, 221, 0.05)';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgba(198, 120, 221, 0.3)';
            uploadArea.style.background = 'rgba(198, 120, 221, 0.05)';
            const files = e.dataTransfer.files;
            this.handleFileUpload(files);
        });

        fileInput.addEventListener('change', (e) => {
            this.handleFileUpload(e.target.files);
        });
    }

    loadInitialData() {
        // 샘플 키워드 데이터
        this.keywords = [
            { id: 1, text: '전파', category: 'technology', createdAt: new Date() },
            { id: 2, text: '주파수', category: 'technology', createdAt: new Date() },
            { id: 3, text: '6G', category: 'technology', createdAt: new Date() },
            { id: 4, text: '정책', category: 'policy', createdAt: new Date() },
            { id: 5, text: 'AI', category: 'technology', createdAt: new Date() }
        ];

        // 샘플 사이트 데이터
        this.sites = [
            {
                id: 1,
                name: '한국방송통신위원회',
                url: 'https://www.kca.go.kr',
                type: 'government',
                description: '방송통신 정책 및 규제 기관',
                status: 'active',
                createdAt: new Date('2024-01-10')
            },
            {
                id: 2,
                name: '전자신문',
                url: 'https://www.etnews.com',
                type: 'news',
                description: 'IT 전문 뉴스 매체',
                status: 'active',
                createdAt: new Date('2024-01-12')
            },
            {
                id: 3,
                name: '네이버 뉴스',
                url: 'https://news.naver.com',
                type: 'news',
                description: '종합 뉴스 포털',
                status: 'inactive',
                createdAt: new Date('2024-01-08')
            }
        ];

        this.updateKeywordDisplay();
        this.updateSiteDisplay();
    }

    async loadStats() {
        const statsGrid = document.getElementById('dashboard-stats-grid');
        
        // 샘플 통계 데이터
        const stats = [
            {
                id: 'active_jobs',
                icon: '🔍',
                number: 24,
                label: '활성 크롤링 작업',
                change: { value: 5, type: 'positive', text: '전일 대비' },
                type: 'primary'
            },
            {
                id: 'collected_articles',
                icon: '📰',
                number: 1247,
                label: '오늘 수집된 기사',
                change: { value: 15, type: 'positive', text: '전일 대비' },
                type: 'secondary'
            },
            {
                id: 'success_rate',
                icon: '⚡',
                number: 98,
                label: '수집 성공률 (%)',
                change: { value: 2, type: 'positive', text: '전일 대비' },
                type: 'success'
            },
            {
                id: 'error_count',
                icon: '⚠️',
                number: 3,
                label: '오늘 발생한 오류',
                change: { value: 2, type: 'negative', text: '전일 대비' },
                type: 'danger'
            }
        ];

        statsGrid.innerHTML = stats.map(stat => `
            <div class="stat-card ${stat.type}">
                <div class="stat-icon">${stat.icon}</div>
                <div class="stat-content">
                    <div class="stat-number">${stat.number}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-change ${stat.change.type}">
                        <span>${stat.change.type === 'positive' ? '↗️' : '↘️'}</span>
                        <span>${stat.change.value}% ${stat.change.text}</span>
                    </div>
                </div>
            </div>
        `).join('');

        // 마지막 업데이트 시간
        document.getElementById('stats-last-updated').textContent = new Date().toLocaleTimeString('ko-KR');
    }

    updateAllCounts() {
        document.getElementById('total-keywords').textContent = this.keywords.length;
        document.getElementById('total-sites').textContent = this.sites.filter(s => s.status === 'active').length;
        document.getElementById('keyword-count-badge').textContent = `${this.keywords.length}개`;
    }

    // 키워드 관리
    addKeyword() {
        const input = document.getElementById('keyword-input');
        const categorySelect = document.getElementById('keyword-category');
        
        const keyword = input.value.trim();
        const category = categorySelect.value;

        if (!keyword) {
            this.showMessage('키워드를 입력해주세요.', 'warning');
            return;
        }

        if (this.keywords.some(k => k.text.toLowerCase() === keyword.toLowerCase())) {
            this.showMessage('이미 등록된 키워드입니다.', 'warning');
            return;
        }

        const newKeyword = {
            id: Date.now(),
            text: keyword,
            category: category,
            createdAt: new Date()
        };

        this.keywords.push(newKeyword);
        input.value = '';
        
        this.updateKeywordDisplay();
        this.updateAllCounts();
        this.showMessage(`"${keyword}" 키워드가 추가되었습니다.`, 'success');
    }

    removeKeyword(keywordId) {
        const keyword = this.keywords.find(k => k.id === keywordId);
        if (keyword) {
            this.keywords = this.keywords.filter(k => k.id !== keywordId);
            this.updateKeywordDisplay();
            this.updateAllCounts();
            this.showMessage(`"${keyword.text}" 키워드가 삭제되었습니다.`, 'info');
        }
    }

    filterKeywords(category) {
        this.currentFilter = category;
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-category="${category}"]`).classList.add('active');
        
        this.updateKeywordDisplay();
    }

    updateKeywordDisplay() {
        const container = document.getElementById('keyword-tags');
        const emptyState = document.getElementById('keywords-empty-state');

        const filteredKeywords = this.currentFilter === 'all' 
            ? this.keywords 
            : this.keywords.filter(k => k.category === this.currentFilter);

        if (filteredKeywords.length === 0) {
            container.style.display = 'none';
            emptyState.classList.remove('hidden');
        } else {
            container.style.display = 'flex';
            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredKeywords.map(keyword => `
                <div class="keyword-tag ${keyword.category}" data-id="${keyword.id}">
                    <span class="keyword-text">${keyword.text}</span>
                    <button class="remove-keyword" onclick="dashboard.removeKeyword(${keyword.id})" title="키워드 삭제">
                        ✕
                    </button>
                </div>
            `).join('');
        }
    }

    // 사이트 관리
    handleFileUpload(files) {
        for (let file of files) {
            if (this.validateFile(file)) {
                this.processExcelFile(file);
            }
        }
    }

    validateFile(file) {
        const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                           'application/vnd.ms-excel'];
        const maxSize = 10 * 1024 * 1024; // 10MB

        if (!validTypes.includes(file.type)) {
            this.showMessage('Excel 파일만 업로드 가능합니다.', 'error');
            return false;
        }

        if (file.size > maxSize) {
            this.showMessage('파일 크기는 10MB 이하여야 합니다.', 'error');
            return false;
        }

        return true;
    }

    async processExcelFile(file) {
        // Excel 파일 처리 시뮬레이션
        const newSites = [
            {
                name: '과학기술정보통신부',
                url: 'https://www.msit.go.kr',
                type: 'government',
                description: '과학기술정보통신 정책 부처',
                status: 'active'
            }
        ];

        this.addSites(newSites);
        this.showMessage(`${newSites.length}개의 사이트가 성공적으로 등록되었습니다.`, 'success');
    }

    addSites(sites) {
        sites.forEach(site => {
            const newSite = {
                id: Date.now() + Math.random(),
                ...site,
                createdAt: new Date()
            };
            this.sites.push(newSite);
        });
        
        this.updateSiteDisplay();
        this.updateAllCounts();
    }

    updateSiteDisplay() {
        const container = document.getElementById('sites-grid');
        const emptyState = document.getElementById('sites-empty-state');

        if (this.sites.length === 0) {
            container.style.display = 'none';
            emptyState.classList.remove('hidden');
        } else {
            container.style.display = 'grid';
            emptyState.classList.add('hidden');
            
            container.innerHTML = this.sites.map(site => this.createSiteCard(site)).join('');
        }
    }

    createSiteCard(site) {
        const typeNames = {
            government: '정부기관',
            news: '언론사',
            tech: '기술블로그',
            research: '연구기관'
        };

        const statusNames = {
            active: '활성',
            inactive: '비활성',
            error: '오류'
        };

        return `
            <div class="site-card" data-id="${site.id}">
                <div class="site-header">
                    <div class="site-info">
                        <div class="site-name">${site.name}</div>
                        <a href="${site.url}" target="_blank" class="site-url">${site.url}</a>
                    </div>
                    <div class="site-status ${site.status}">${statusNames[site.status]}</div>
                </div>
                <div class="site-meta">
                    <span class="site-type ${site.type}">${typeNames[site.type]}</span>
                    <span class="site-created">등록: ${new Date(site.createdAt).toLocaleDateString()}</span>
                </div>
                ${site.description ? `<div class="site-description">${site.description}</div>` : ''}
                <div class="site-actions">
                    <button class="btn-test" onclick="dashboard.testSite(${site.id})">테스트</button>
                    <button class="btn-edit" onclick="dashboard.editSite(${site.id})">수정</button>
                    <button class="btn-delete" onclick="dashboard.deleteSite(${site.id})">삭제</button>
                </div>
            </div>
        `;
    }

    // 크롤링 실행
    async startWeeklyCrawling() {
        if (this.isRunning) return;

        if (this.keywords.length === 0) {
            this.showMessage('크롤링할 키워드를 먼저 등록해주세요.', 'warning');
            return;
        }

        if (this.sites.filter(s => s.status === 'active').length === 0) {
            this.showMessage('활성화된 사이트가 없습니다.', 'warning');
            return;
        }

        this.isRunning = true;
        this.showCrawlingProgress();
        this.updateCrawlingStatus('running', '크롤링 시작');
        
        try {
            await this.performCrawling();
            this.completeCrawling();
        } catch (error) {
            this.handleCrawlingError(error);
        }
    }

    showCrawlingProgress() {
        document.getElementById('crawling-progress-card').classList.remove('hidden');
        document.getElementById('start-weekly-crawling-btn').disabled = true;
        document.getElementById('start-weekly-crawling-btn').innerHTML = 
            '<i class="icon">⏳</i><span class="btn-text">크롤링 진행중...</span>';
    }

    updateCrawlingStatus(status, message) {
        const indicator = document.getElementById('crawling-status-indicator');
        const dot = indicator.querySelector('.status-dot');
        const text = indicator.querySelector('.status-text');
        
        dot.className = `status-dot ${status}`;
        text.textContent = message;
    }

    async performCrawling() {
        const activeSites = this.sites.filter(s => s.status === 'active');
        const totalTasks = activeSites.length * this.keywords.length;
        let completedTasks = 0;
        let collectedArticles = 0;

        document.getElementById('total-sites-progress').textContent = activeSites.length;

        // 경과 시간 타이머 시작
        const startTime = Date.now();
        const timer = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('elapsed-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);

        for (let siteIndex = 0; siteIndex < activeSites.length; siteIndex++) {
            if (!this.isRunning) break;

            const site = activeSites[siteIndex];
            document.getElementById('current-status').textContent = `${site.name} 처리 중...`;
            
            for (let keyword of this.keywords) {
                if (!this.isRunning) break;

                // 크롤링 시뮬레이션
                await this.sleep(500);
                
                completedTasks++;
                collectedArticles += Math.floor(Math.random() * 3) + 1;
                
                const progress = Math.round((completedTasks / totalTasks) * 100);
                this.updateProgress(progress, siteIndex + 1, collectedArticles);
            }
        }

        clearInterval(timer);
    }

    updateProgress(percentage, processedSites, collectedArticles) {
        document.getElementById('overall-progress-fill').style.width = percentage + '%';
        document.getElementById('overall-percentage').textContent = percentage + '%';
        document.getElementById('processed-sites').textContent = processedSites;
        document.getElementById('collected-articles').textContent = collectedArticles;
        
        const successRate = Math.min(Math.round((collectedArticles / (processedSites * this.keywords.length)) * 100), 100);
        document.getElementById('success-rate').textContent = successRate + '%';
    }

    completeCrawling() {
        this.isRunning = false;
        this.updateCrawlingStatus('completed', '크롤링 완료');
        
        // 버튼 복원
        document.getElementById('start-weekly-crawling-btn').disabled = false;
        document.getElementById('start-weekly-crawling-btn').innerHTML = 
            '<i class="icon">🚀</i><span class="btn-text">주간 크롤링 시작</span>';
        
        // 마지막 실행 시간 업데이트
        document.getElementById('last-crawl-date').textContent = new Date().toLocaleDateString();
        
        this.showMessage('주간 크롤링이 성공적으로 완료되었습니다!', 'success');
        
        // 통계 새로고침
        setTimeout(() => {
            this.loadStats();
        }, 1000);
    }

    handleCrawlingError(error) {
        this.isRunning = false;
        this.updateCrawlingStatus('error', '크롤링 오류');
        this.showMessage('크롤링 중 오류가 발생했습니다: ' + error.message, 'error');
    }

    // 유틸리티 메서드
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    showMessage(message, type = 'info') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'rgb(152, 195, 121)' : 
                        type === 'error' ? 'rgb(224, 108, 117)' : 
                        type === 'warning' ? 'rgb(229, 192, 123)' : 'rgb(86, 182, 194)'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        `;
        
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    // 사이트 액션
    testSite(siteId) {
        const site = this.sites.find(s => s.id === siteId);
        if (site) {
            this.showMessage(`${site.name} 사이트 연결을 테스트 중...`, 'info');
        }
    }

    editSite(siteId) {
        console.log('Edit site:', siteId);
    }

    deleteSite(siteId) {
        if (confirm('정말로 이 사이트를 삭제하시겠습니까?')) {
            this.sites = this.sites.filter(s => s.id !== siteId);
            this.updateSiteDisplay();
            this.updateAllCounts();
            this.showMessage('사이트가 삭제되었습니다.', 'info');
        }
    }
}

// 전역 인스턴스
let dashboard;

// 외부 함수들
function refreshAllStats() {
    if (dashboard) {
        dashboard.loadStats();
        dashboard.showMessage('통계가 새로고침되었습니다.', 'info');
    }
}

function startWeeklyCrawling() {
    if (dashboard) {
        dashboard.startWeeklyCrawling();
    }
}

function pauseCrawling() {
    if (dashboard && dashboard.isRunning) {
        dashboard.isRunning = false;
        dashboard.updateCrawlingStatus('paused', '일시정지됨');
        dashboard.showMessage('크롤링이 일시정지되었습니다.', 'info');
    }
}

function stopCrawling() {
    if (dashboard && dashboard.isRunning) {
        if (confirm('정말로 크롤링을 중지하시겠습니까?')) {
            dashboard.isRunning = false;
            dashboard.updateCrawlingStatus('idle', '대기중');
            document.getElementById('crawling-progress-card').classList.add('hidden');
            document.getElementById('start-weekly-crawling-btn').disabled = false;
            document.getElementById('start-weekly-crawling-btn').innerHTML = 
                '<i class="icon">🚀</i><span class="btn-text">주간 크롤링 시작</span>';
            dashboard.showMessage('크롤링이 중지되었습니다.', 'warning');
        }
    }
}

function switchSettingsTab(tabName) {
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.settings-content').forEach(content => {
        content.classList.remove('active');
    });
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-settings').classList.add('active');
}

function addKeyword() {
    if (dashboard) {
        dashboard.addKeyword();
    }
}

function filterKeywords(category) {
    if (dashboard) {
        dashboard.filterKeywords(category);
    }
}

function filterSites() {
    // 사이트 필터링 로직 (필요시 구현)
}

function downloadTemplate() {
    dashboard.showMessage('Excel 템플릿을 다운로드합니다.', 'info');
    // 실제 구현에서는 템플릿 파일 다운로드
}

function openAddSiteModal() {
    document.getElementById('add-site-modal').classList.remove('hidden');
}

function closeAddSiteModal() {
    document.getElementById('add-site-modal').classList.add('hidden');
    // 폼 초기화
    document.getElementById('manual-site-name').value = '';
    document.getElementById('manual-site-url').value = '';
    document.getElementById('manual-site-type').value = 'government';
    document.getElementById('manual-site-description').value = '';
}

function addSiteManually() {
    const name = document.getElementById('manual-site-name').value.trim();
    const url = document.getElementById('manual-site-url').value.trim();
    const type = document.getElementById('manual-site-type').value;
    const description = document.getElementById('manual-site-description').value.trim();

    if (!name || !url) {
        dashboard.showMessage('사이트명과 URL은 필수 입력 항목입니다.', 'error');
        return;
    }

    const newSite = {
        name,
        url,
        type,
        description,
        status: 'active'
    };

    dashboard.addSites([newSite]);
    closeAddSiteModal();
    dashboard.showMessage('사이트가 성공적으로 추가되었습니다.', 'success');
}

function viewAllResults() {
    dashboard.showMessage('전체 크롤링 결과 페이지로 이동합니다.', 'info');
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    dashboard = new IntegratedDashboard();
});

// 슬라이드 인 애니메이션
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
