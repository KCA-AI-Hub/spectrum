{% extends "base.html" %}

{% block title %}í†µí•© ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - spectrum í¬ë¡¤ë§ ë¹„ë””ì˜¤ ìƒì„± í”Œë«í¼{% endblock %}

{% block content %}
<div class="admin-dashboard-container">
    <!-- ì‚¬ìš©ì ì •ë³´ -->
    <div class="user-info-bar">
        <div class="user-info">
            <div class="user-avatar admin">
                <i class="icon-crown">ğŸ‘‘</i>
            </div>
            <div class="user-details">
                <div class="user-name">ê´€ë¦¬ì</div>
                <div class="user-role">ì‹œìŠ¤í…œ ê´€ë¦¬</div>
            </div>
            <a href="{{ url_for('logout') }}" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </div>

    <!-- í—¤ë” -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">í¬ë¡¤ë§ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
        <p class="dashboard-subtitle">Firecrawl API ê¸°ë°˜ ì •ì±…ë™í–¥ ë¶„ì„ ì‹œìŠ¤í…œ</p>
    </div>

    <!-- í†µê³„ ê°œìš” ì„¹ì…˜ -->
    <div class="stats-overview-section">
        <div class="section-header">
            <h2 class="section-title">í¬ë¡¤ë§ í˜„í™©</h2>
            <div class="section-actions">
                <button class="btn-refresh-stats" onclick="refreshAllStats()">
                    <i class="icon">ğŸ”„</i> ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
        <div class="stats-grid" id="dashboard-stats-grid">
            <!-- í†µê³„ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        <div class="last-updated">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="stats-last-updated">-</span>
        </div>
    </div>

    <!-- í¬ë¡¤ë§ ì‹¤í–‰ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ -->
    <div class="crawling-control-section">
        <div class="section-header">
            <h2 class="section-title">ì£¼ê°„ í¬ë¡¤ë§ ì‹¤í–‰</h2>
            <div class="crawling-status-indicator" id="crawling-status-indicator">
                <span class="status-dot idle"></span>
                <span class="status-text">ëŒ€ê¸°ì¤‘</span>
            </div>
        </div>

        <!-- í¬ë¡¤ë§ ì„¤ì • ìš”ì•½ -->
        <div class="crawling-summary-card">
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-icon">ğŸ·ï¸</div>
                    <div class="summary-content">
                        <div class="summary-value" id="total-keywords">0</div>
                        <div class="summary-label">ë“±ë¡ëœ í‚¤ì›Œë“œ</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">ğŸŒ</div>
                    <div class="summary-content">
                        <div class="summary-value" id="total-sites">0</div>
                        <div class="summary-label">ëŒ€ìƒ ì‚¬ì´íŠ¸</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">â±ï¸</div>
                    <div class="summary-content">
                        <div class="summary-value" id="estimated-duration">15-20ë¶„</div>
                        <div class="summary-label">ì˜ˆìƒ ì†Œìš”ì‹œê°„</div>
                    </div>
                </div>
                <div class="summary-item">
                    <div class="summary-icon">ğŸ“…</div>
                    <div class="summary-content">
                        <div class="summary-value" id="last-crawl-date">ë¯¸ì‹¤í–‰</div>
                        <div class="summary-label">ë§ˆì§€ë§‰ ì‹¤í–‰</div>
                    </div>
                </div>
            </div>
            
            <!-- ì£¼ê°„ í¬ë¡¤ë§ ì‹¤í–‰ ë²„íŠ¼ -->
            <div class="main-action">
                <button class="btn-start-weekly-crawling" id="start-weekly-crawling-btn" onclick="startWeeklyCrawling()">
                    <i class="icon">ğŸš€</i>
                    <span class="btn-text">ì£¼ê°„ í¬ë¡¤ë§ ì‹œì‘</span>
                </button>
            </div>
        </div>

        <!-- í¬ë¡¤ë§ ì§„í–‰ ìƒí™© (ìˆ¨ê¹€ ìƒíƒœ) -->
        <div class="crawling-progress-card hidden" id="crawling-progress-card">
            <div class="progress-header">
                <h3 class="progress-title">í¬ë¡¤ë§ ì§„í–‰ ìƒí™©</h3>
                <div class="progress-meta">
                    <span class="elapsed-time" id="elapsed-time">00:00</span>
                    <span class="current-status" id="current-status">ì¤€ë¹„ì¤‘...</span>
                </div>
            </div>
            
            <div class="overall-progress">
                <div class="progress-info">
                    <span class="progress-label">ì „ì²´ ì§„í–‰ë¥ </span>
                    <span class="progress-percentage" id="overall-percentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="overall-progress-fill"></div>
                </div>
            </div>

            <div class="detailed-progress">
                <div class="progress-stats">
                    <div class="progress-stat">
                        <span class="stat-label">ì²˜ë¦¬ëœ ì‚¬ì´íŠ¸</span>
                        <span class="stat-value"><span id="processed-sites">0</span>/<span id="total-sites-progress">0</span></span>
                    </div>
                    <div class="progress-stat">
                        <span class="stat-label">ìˆ˜ì§‘ëœ ê¸°ì‚¬</span>
                        <span class="stat-value" id="collected-articles">0</span>
                    </div>
                    <div class="progress-stat">
                        <span class="stat-label">ì„±ê³µë¥ </span>
                        <span class="stat-value" id="success-rate">0%</span>
                    </div>
                </div>
            </div>

            <div class="crawling-controls">
                <button class="btn-pause" id="pause-btn" onclick="pauseCrawling()">
                    <i class="icon">â¸ï¸</i> ì¼ì‹œì •ì§€
                </button>
                <button class="btn-stop" id="stop-btn" onclick="stopCrawling()">
                    <i class="icon">â¹ï¸</i> ì¤‘ì§€
                </button>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • ê´€ë¦¬ ì„¹ì…˜ -->
    <div class="settings-section">
        <div class="settings-tabs">
            <button class="settings-tab active" onclick="switchSettingsTab('keywords')">
                ğŸ·ï¸ í‚¤ì›Œë“œ ê´€ë¦¬
            </button>
            <button class="settings-tab" onclick="switchSettingsTab('sites')">
                ğŸŒ ì‚¬ì´íŠ¸ ê´€ë¦¬
            </button>
        </div>

        <!-- í‚¤ì›Œë“œ ê´€ë¦¬ íƒ­ -->
        <div class="settings-content active" id="keywords-settings">
            <div class="settings-header">
                <h3 class="settings-title">í¬ë¡¤ë§ í‚¤ì›Œë“œ ì„¤ì •</h3>
                <div class="keyword-count-badge" id="keyword-count-badge">0ê°œ</div>
            </div>
            
            <div class="keyword-input-section">
                <div class="keyword-input-group">
                    <input type="text" 
                           id="keyword-input" 
                           class="keyword-input" 
                           placeholder="í‚¤ì›Œë“œ ì…ë ¥ (ì˜ˆ: ì „íŒŒ, ì£¼íŒŒìˆ˜, 6G)"
                           maxlength="50">
                    <select id="keyword-category" class="category-select">
                        <option value="technology">ê¸°ìˆ </option>
                        <option value="policy">ì •ì±…</option>
                        <option value="industry">ì‚°ì—…</option>
                        <option value="research">ì—°êµ¬</option>
                    </select>
                    <button type="button" class="btn-add-keyword" onclick="addKeyword()">
                        <i class="icon">â•</i> ì¶”ê°€
                    </button>
                </div>
            </div>

            <div class="keyword-tags-container">
                <div class="keyword-tags" id="keyword-tags">
                    <!-- í‚¤ì›Œë“œ íƒœê·¸ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
                <div class="empty-state" id="keywords-empty-state">
                    <div class="empty-icon">ğŸ·ï¸</div>
                    <div class="empty-text">ë“±ë¡ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    <div class="empty-subtext">ìœ„ì—ì„œ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</div>
                </div>
            </div>

            <div class="keyword-filters">
                <div class="filter-label">ì¹´í…Œê³ ë¦¬ë³„ ë³´ê¸°:</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-category="all" onclick="filterKeywords('all')">ì „ì²´</button>
                    <button class="filter-btn" data-category="technology" onclick="filterKeywords('technology')">ê¸°ìˆ </button>
                    <button class="filter-btn" data-category="policy" onclick="filterKeywords('policy')">ì •ì±…</button>
                    <button class="filter-btn" data-category="industry" onclick="filterKeywords('industry')">ì‚°ì—…</button>
                    <button class="filter-btn" data-category="research" onclick="filterKeywords('research')">ì—°êµ¬</button>
                </div>
            </div>
        </div>

        <!-- ì‚¬ì´íŠ¸ ê´€ë¦¬ íƒ­ -->
        <div class="settings-content" id="sites-settings">
            <div class="settings-header">
                <h3 class="settings-title">í¬ë¡¤ë§ ëŒ€ìƒ ì‚¬ì´íŠ¸ ê´€ë¦¬</h3>
                <div class="settings-actions">
                    <button class="btn-download-template" onclick="downloadTemplate()">
                        <i class="icon">ğŸ“‹</i> í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                    </button>
                    <button class="btn-add-site" onclick="openAddSiteModal()">
                        <i class="icon">â•</i> ìˆ˜ë™ ì¶”ê°€
                    </button>
                </div>
            </div>

            <!-- Excel íŒŒì¼ ì—…ë¡œë“œ -->
            <div class="file-upload-area" id="file-upload-area">
                <div class="upload-content">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">
                        <div class="upload-title">Excel íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</div>
                        <div class="upload-subtitle">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</div>
                    </div>
                    <div class="upload-formats">ì§€ì› í˜•ì‹: .xlsx, .xls (ìµœëŒ€ 10MB)</div>
                </div>
                <input type="file" id="site-file-input" accept=".xlsx,.xls" class="file-input">
            </div>

            <!-- ì‚¬ì´íŠ¸ í•„í„° -->
            <div class="site-filters">
                <select class="filter-select" id="site-type-filter" onchange="filterSites()">
                    <option value="">ëª¨ë“  íƒ€ì…</option>
                    <option value="government">ì •ë¶€ê¸°ê´€</option>
                    <option value="news">ì–¸ë¡ ì‚¬</option>
                    <option value="tech">ê¸°ìˆ ë¸”ë¡œê·¸</option>
                    <option value="research">ì—°êµ¬ê¸°ê´€</option>
                </select>
                <select class="filter-select" id="site-status-filter" onchange="filterSites()">
                    <option value="">ëª¨ë“  ìƒíƒœ</option>
                    <option value="active">í™œì„±</option>
                    <option value="inactive">ë¹„í™œì„±</option>
                    <option value="error">ì˜¤ë¥˜</option>
                </select>
                <input type="text" class="search-input" id="site-search" placeholder="ì‚¬ì´íŠ¸ëª… ë˜ëŠ” URL ê²€ìƒ‰..." oninput="filterSites()">
            </div>

            <!-- ì‚¬ì´íŠ¸ ëª©ë¡ -->
            <div class="sites-grid" id="sites-grid">
                <!-- ì‚¬ì´íŠ¸ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>

            <div class="empty-state" id="sites-empty-state">
                <div class="empty-icon">ğŸŒ</div>
                <div class="empty-text">ë“±ë¡ëœ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                <div class="empty-subtext">Excel íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì‚¬ì´íŠ¸ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</div>
            </div>
        </div>
    </div>

    <!-- ìµœê·¼ í¬ë¡¤ë§ ê²°ê³¼ ì„¹ì…˜ -->
    <div class="recent-results-section">
        <div class="section-header">
            <h2 class="section-title">ìµœê·¼ í¬ë¡¤ë§ ê²°ê³¼</h2>
            <button class="btn-view-all" onclick="viewAllResults()">
                ì „ì²´ ë³´ê¸°
            </button>
        </div>
        <div class="results-preview" id="results-preview">
            <!-- ìµœê·¼ í¬ë¡¤ë§ ê²°ê³¼ê°€ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>
</div>

<!-- ìˆ˜ë™ ì‚¬ì´íŠ¸ ì¶”ê°€ ëª¨ë‹¬ -->
<div class="modal hidden" id="add-site-modal">
    <div class="modal-overlay" onclick="closeAddSiteModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">ì‚¬ì´íŠ¸ ìˆ˜ë™ ì¶”ê°€</h3>
            <button class="modal-close" onclick="closeAddSiteModal()">âœ•</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">ì‚¬ì´íŠ¸ëª… *</label>
                <input type="text" id="manual-site-name" class="form-input" placeholder="ì˜ˆ: í•œêµ­ë°©ì†¡í†µì‹ ìœ„ì›íšŒ">
            </div>
            <div class="form-group">
                <label class="form-label">URL *</label>
                <input type="url" id="manual-site-url" class="form-input" placeholder="https://www.kca.go.kr">
            </div>
            <div class="form-group">
                <label class="form-label">ì‚¬ì´íŠ¸ íƒ€ì…</label>
                <select id="manual-site-type" class="form-select">
                    <option value="government">ì •ë¶€ê¸°ê´€</option>
                    <option value="news">ì–¸ë¡ ì‚¬</option>
                    <option value="tech">ê¸°ìˆ ë¸”ë¡œê·¸</option>
                    <option value="research">ì—°êµ¬ê¸°ê´€</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ì„¤ëª…</label>
                <textarea id="manual-site-description" class="form-textarea" placeholder="ì‚¬ì´íŠ¸ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeAddSiteModal()">ì·¨ì†Œ</button>
            <button class="btn-primary" onclick="addSiteManually()">ì¶”ê°€</button>
        </div>
    </div>
</div>

<style>
/* í†µí•© ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
.admin-dashboard-container {
    min-height: 100vh;
    background: linear-gradient(135deg, rgb(15, 23, 42) 0%, rgb(30, 41, 59) 100%);
    padding: 20px;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* ì‚¬ìš©ì ì •ë³´ ë°” */
.user-info-bar {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 100;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 12px 16px;
}

.user-avatar.admin {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, rgb(224, 108, 117), rgb(229, 192, 123));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.user-details {
    text-align: right;
}

.user-name {
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
}

.user-role {
    color: rgb(171, 178, 191);
    font-size: 0.8rem;
}

.logout-btn {
    background: rgba(224, 108, 117, 0.2);
    border: 1px solid rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.8rem;
    transition: all 0.2s ease;
}

.logout-btn:hover {
    background: rgba(224, 108, 117, 0.3);
}

/* ëŒ€ì‹œë³´ë“œ í—¤ë” */
.dashboard-header {
    text-align: center;
    margin: 60px 0 40px;
}

.dashboard-title {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 12px;
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.dashboard-subtitle {
    color: rgb(171, 178, 191);
    font-size: 1.1rem;
}

/* ì„¹ì…˜ ê³µí†µ ìŠ¤íƒ€ì¼ */
.stats-overview-section,
.crawling-control-section,
.settings-section,
.recent-results-section {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 32px;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.section-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 600;
}

.section-actions {
    display: flex;
    gap: 12px;
}

/* í†µê³„ ê·¸ë¦¬ë“œ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 16px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.stat-card.primary { border-left: 4px solid rgb(198, 120, 221); }
.stat-card.secondary { border-left: 4px solid rgb(86, 182, 194); }
.stat-card.success { border-left: 4px solid rgb(152, 195, 121); }
.stat-card.warning { border-left: 4px solid rgb(229, 192, 123); }
.stat-card.danger { border-left: 4px solid rgb(224, 108, 117); }

.stat-icon {
    font-size: 3rem;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.stat-card.primary .stat-icon { background: rgba(198, 120, 221, 0.2); color: rgb(198, 120, 221); }
.stat-card.secondary .stat-icon { background: rgba(86, 182, 194, 0.2); color: rgb(86, 182, 194); }
.stat-card.success .stat-icon { background: rgba(152, 195, 121, 0.2); color: rgb(152, 195, 121); }
.stat-card.warning .stat-icon { background: rgba(229, 192, 123, 0.2); color: rgb(229, 192, 123); }
.stat-card.danger .stat-icon { background: rgba(224, 108, 117, 0.2); color: rgb(224, 108, 117); }

.stat-content {
    flex: 1;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 4px;
    line-height: 1;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.stat-change {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85rem;
    font-weight: 500;
}

.stat-change.positive { color: rgb(152, 195, 121); }
.stat-change.negative { color: rgb(224, 108, 117); }
.stat-change.neutral { color: rgb(171, 178, 191); }

.last-updated {
    text-align: center;
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* í¬ë¡¤ë§ ìƒíƒœ í‘œì‹œê¸° */
.crawling-status-indicator {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-dot.idle { background: rgb(171, 178, 191); animation: none; }
.status-dot.running { background: rgb(152, 195, 121); }
.status-dot.paused { background: rgb(229, 192, 123); }
.status-dot.completed { background: rgb(86, 182, 194); }
.status-dot.error { background: rgb(224, 108, 117); }

.status-text {
    color: white;
    font-size: 0.9rem;
    font-weight: 500;
}

/* í¬ë¡¤ë§ ìš”ì•½ ì¹´ë“œ */
.crawling-summary-card {
    background: rgba(198, 120, 221, 0.1);
    border: 1px solid rgba(198, 120, 221, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.summary-icon {
    font-size: 2rem;
    color: rgb(198, 120, 221);
}

.summary-value {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 4px;
}

.summary-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* ì£¼ê°„ í¬ë¡¤ë§ ì‹¤í–‰ ë²„íŠ¼ */
.main-action {
    text-align: center;
}

.btn-start-weekly-crawling {
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    color: white;
    border: none;
    border-radius: 16px;
    padding: 20px 40px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 12px;
    transition: all 0.3s ease;
    box-shadow: 0 8px 24px rgba(198, 120, 221, 0.3);
}

.btn-start-weekly-crawling:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(198, 120, 221, 0.4);
}

.btn-start-weekly-crawling:disabled {
    background: rgba(171, 178, 191, 0.3);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.btn-start-weekly-crawling .icon {
    font-size: 1.4rem;
}

/* í¬ë¡¤ë§ ì§„í–‰ ì¹´ë“œ */
.crawling-progress-card {
    background: rgba(86, 182, 194, 0.1);
    border: 1px solid rgba(86, 182, 194, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-top: 24px;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.progress-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.progress-meta {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.elapsed-time {
    font-family: monospace;
    color: rgb(86, 182, 194);
}

.overall-progress {
    margin-bottom: 20px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-label {
    color: white;
    font-weight: 500;
}

.progress-percentage {
    color: rgb(86, 182, 194);
    font-weight: 600;
    font-size: 1.1rem;
}

.progress-bar {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    height: 12px;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, rgb(86, 182, 194), rgb(198, 120, 221));
    height: 100%;
    width: 0%;
    border-radius: 8px;
    transition: width 0.5s ease;
}

.detailed-progress {
    margin-bottom: 20px;
}

.progress-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
}

.progress-stat {
    text-align: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.stat-value {
    color: white;
    font-weight: 600;
    font-size: 1rem;
}

.crawling-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.btn-pause, .btn-stop {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgb(171, 178, 191);
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-pause:hover {
    background: rgba(229, 192, 123, 0.2);
    border-color: rgba(229, 192, 123, 0.3);
    color: rgb(229, 192, 123);
}

.btn-stop:hover {
    background: rgba(224, 108, 117, 0.2);
    border-color: rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
}

/* ì„¤ì • íƒ­ */
.settings-tabs {
    display: flex;
    gap: 4px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 4px;
    margin-bottom: 24px;
}

.settings-tab {
    padding: 12px 24px;
    background: transparent;
    border: none;
    color: rgb(171, 178, 191);
    font-weight: 500;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.settings-tab:hover {
    background: rgba(255, 255, 255, 0.05);
    color: white;
}

.settings-tab.active {
    background: rgb(198, 120, 221);
    color: white;
}

.settings-content {
    display: none;
}

.settings-content.active {
    display: block;
}

.settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.settings-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.settings-actions {
    display: flex;
    gap: 8px;
}

.keyword-count-badge {
    background: rgba(198, 120, 221, 0.2);
    color: rgb(198, 120, 221);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 500;
}

/* í‚¤ì›Œë“œ ì…ë ¥ */
.keyword-input-section {
    margin-bottom: 24px;
}

.keyword-input-group {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
}

.keyword-input {
    flex: 1;
    min-width: 250px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 16px;
    color: white;
    font-size: 0.95rem;
}

.keyword-input:focus {
    outline: none;
    border-color: rgb(198, 120, 221);
    background: rgba(255, 255, 255, 0.08);
}

.keyword-input::placeholder {
    color: rgb(171, 178, 191);
}

.category-select {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 16px;
    color: white;
    min-width: 120px;
}

.btn-add-keyword {
    background: rgb(198, 120, 221);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-add-keyword:hover {
    background: rgb(178, 100, 201);
    transform: translateY(-1px);
}

/* í‚¤ì›Œë“œ íƒœê·¸ */
.keyword-tags-container {
    margin-bottom: 24px;
}

.keyword-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 40px;
}

.keyword-tag {
    background: rgba(198, 120, 221, 0.2);
    border: 1px solid rgba(198, 120, 221, 0.3);
    color: rgb(198, 120, 221);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.keyword-tag:hover {
    background: rgba(198, 120, 221, 0.3);
    transform: translateY(-1px);
}

.keyword-tag.technology { background: rgba(198, 120, 221, 0.2); border-color: rgba(198, 120, 221, 0.3); color: rgb(198, 120, 221); }
.keyword-tag.policy { background: rgba(86, 182, 194, 0.2); border-color: rgba(86, 182, 194, 0.3); color: rgb(86, 182, 194); }
.keyword-tag.industry { background: rgba(152, 195, 121, 0.2); border-color: rgba(152, 195, 121, 0.3); color: rgb(152, 195, 121); }
.keyword-tag.research { background: rgba(229, 192, 123, 0.2); border-color: rgba(229, 192, 123, 0.3); color: rgb(229, 192, 123); }

.remove-keyword {
    background: none;
    border: none;
    color: currentColor;
    cursor: pointer;
    font-size: 1.1rem;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.remove-keyword:hover {
    opacity: 1;
}

.keyword-filters {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 16px;
}

.filter-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 8px;
}

.filter-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.filter-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgb(171, 178, 191);
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background: rgba(255, 255, 255, 0.08);
    color: white;
}

.filter-btn.active {
    background: rgb(198, 120, 221);
    border-color: rgb(198, 120, 221);
    color: white;
}

/* íŒŒì¼ ì—…ë¡œë“œ */
.file-upload-area {
    border: 2px dashed rgba(198, 120, 221, 0.3);
    border-radius: 12px;
    padding: 40px 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    background: rgba(198, 120, 221, 0.05);
    margin-bottom: 24px;
}

.file-upload-area:hover {
    border-color: rgba(198, 120, 221, 0.5);
    background: rgba(198, 120, 221, 0.08);
}

.file-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 16px;
}

.upload-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.upload-subtitle {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 16px;
}

.upload-formats {
    color: rgb(156, 163, 175);
    font-size: 0.8rem;
}

/* ì‚¬ì´íŠ¸ í•„í„° */
.site-filters {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.filter-select, .search-input {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 8px 12px;
    color: white;
    font-size: 0.9rem;
}

.filter-select {
    min-width: 120px;
}

.search-input {
    flex: 1;
    min-width: 200px;
}

.search-input::placeholder {
    color: rgb(171, 178, 191);
}

/* ì‚¬ì´íŠ¸ ê·¸ë¦¬ë“œ */
.sites-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 16px;
}

.site-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s ease;
}

.site-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

/* ë¹ˆ ìƒíƒœ */
.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: rgb(171, 178, 191);
}

.empty-state.hidden {
    display: none;
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-text {
    font-size: 1.1rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.empty-subtext {
    font-size: 0.9rem;
    opacity: 0.8;
}

/* ìµœê·¼ ê²°ê³¼ */
.results-preview {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 20px;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-refresh-stats, .btn-download-template, .btn-add-site, .btn-view-all {
    background: rgba(86, 182, 194, 0.2);
    border: 1px solid rgba(86, 182, 194, 0.3);
    color: rgb(86, 182, 194);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    text-decoration: none;
}

.btn-refresh-stats:hover, .btn-download-template:hover, .btn-add-site:hover, .btn-view-all:hover {
    background: rgba(86, 182, 194, 0.3);
    transform: translateY(-1px);
}

/* ëª¨ë‹¬ */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal.hidden {
    display: none;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
}

.modal-content {
    background: rgb(31, 35, 40);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    z-index: 1;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-title {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    color: rgb(171, 178, 191);
    font-size: 1.5rem;
    cursor: pointer;
}

.modal-body {
    padding: 24px;
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    color: white;
    font-weight: 500;
    margin-bottom: 8px;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 10px 12px;
    color: white;
    font-size: 0.9rem;
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.modal-footer {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    padding: 20px 24px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgb(171, 178, 191);
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
}

.btn-primary {
    background: rgb(198, 120, 221);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
}

/* ìœ í‹¸ë¦¬í‹° */
.hidden {
    display: none !important;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .dashboard-title {
        font-size: 2rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .summary-grid {
        grid-template-columns: 1fr;
    }
    
    .keyword-input-group {
        flex-direction: column;
    }
    
    .site-filters {
        flex-direction: column;
    }
    
    .sites-grid {
        grid-template-columns: 1fr;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    
    .settings-tabs {
        flex-direction: column;
    }
}
</style>

<script>
// í†µí•© ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ JavaScript
class IntegratedDashboard {
    constructor() {
        this.keywords = [];
        this.sites = [];
        this.isRunning = false;
        this.currentFilter = 'all';
        this.crawlingJob = null;
        this.init();
    }

    init() {
        this.loadInitialData();
        this.setupEventListeners();
        this.updateAllCounts();
        this.loadStats();
    }

    setupEventListeners() {
        // Enter í‚¤ë¡œ í‚¤ì›Œë“œ ì¶”ê°€
        const keywordInput = document.getElementById('keyword-input');
        keywordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.addKeyword();
            }
        });

        // íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
        this.setupFileUpload();
    }

    setupFileUpload() {
        const uploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('site-file-input');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgb(198, 120, 221)';
            uploadArea.style.background = 'rgba(198, 120, 221, 0.1)';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgba(198, 120, 221, 0.3)';
            uploadArea.style.background = 'rgba(198, 120, 221, 0.05)';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgba(198, 120, 221, 0.3)';
            uploadArea.style.background = 'rgba(198, 120, 221, 0.05)';
            const files = e.dataTransfer.files;
            this.handleFileUpload(files);
        });

        fileInput.addEventListener('change', (e) => {
            this.handleFileUpload(e.target.files);
        });
    }

    loadInitialData() {
        // ìƒ˜í”Œ í‚¤ì›Œë“œ ë°ì´í„°
        this.keywords = [
            { id: 1, text: 'ì „íŒŒ', category: 'technology', createdAt: new Date() },
            { id: 2, text: 'ì£¼íŒŒìˆ˜', category: 'technology', createdAt: new Date() },
            { id: 3, text: '6G', category: 'technology', createdAt: new Date() },
            { id: 4, text: 'ì •ì±…', category: 'policy', createdAt: new Date() },
            { id: 5, text: 'AI', category: 'technology', createdAt: new Date() }
        ];

        // ìƒ˜í”Œ ì‚¬ì´íŠ¸ ë°ì´í„°
        this.sites = [
            {
                id: 1,
                name: 'í•œêµ­ë°©ì†¡í†µì‹ ìœ„ì›íšŒ',
                url: 'https://www.kca.go.kr',
                type: 'government',
                description: 'ë°©ì†¡í†µì‹  ì •ì±… ë° ê·œì œ ê¸°ê´€',
                status: 'active',
                createdAt: new Date('2024-01-10')
            },
            {
                id: 2,
                name: 'ì „ìì‹ ë¬¸',
                url: 'https://www.etnews.com',
                type: 'news',
                description: 'IT ì „ë¬¸ ë‰´ìŠ¤ ë§¤ì²´',
                status: 'active',
                createdAt: new Date('2024-01-12')
            },
            {
                id: 3,
                name: 'ë„¤ì´ë²„ ë‰´ìŠ¤',
                url: 'https://news.naver.com',
                type: 'news',
                description: 'ì¢…í•© ë‰´ìŠ¤ í¬í„¸',
                status: 'inactive',
                createdAt: new Date('2024-01-08')
            }
        ];

        this.updateKeywordDisplay();
        this.updateSiteDisplay();
    }

    async loadStats() {
        const statsGrid = document.getElementById('dashboard-stats-grid');
        
        // ìƒ˜í”Œ í†µê³„ ë°ì´í„°
        const stats = [
            {
                id: 'active_jobs',
                icon: 'ğŸ”',
                number: 24,
                label: 'í™œì„± í¬ë¡¤ë§ ì‘ì—…',
                change: { value: 5, type: 'positive', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'primary'
            },
            {
                id: 'collected_articles',
                icon: 'ğŸ“°',
                number: 1247,
                label: 'ì˜¤ëŠ˜ ìˆ˜ì§‘ëœ ê¸°ì‚¬',
                change: { value: 15, type: 'positive', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'secondary'
            },
            {
                id: 'success_rate',
                icon: 'âš¡',
                number: 98,
                label: 'ìˆ˜ì§‘ ì„±ê³µë¥  (%)',
                change: { value: 2, type: 'positive', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'success'
            },
            {
                id: 'error_count',
                icon: 'âš ï¸',
                number: 3,
                label: 'ì˜¤ëŠ˜ ë°œìƒí•œ ì˜¤ë¥˜',
                change: { value: 2, type: 'negative', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'danger'
            }
        ];

        statsGrid.innerHTML = stats.map(stat => `
            <div class="stat-card ${stat.type}">
                <div class="stat-icon">${stat.icon}</div>
                <div class="stat-content">
                    <div class="stat-number">${stat.number}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-change ${stat.change.type}">
                        <span>${stat.change.type === 'positive' ? 'â†—ï¸' : 'â†˜ï¸'}</span>
                        <span>${stat.change.value}% ${stat.change.text}</span>
                    </div>
                </div>
            </div>
        `).join('');

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
        document.getElementById('stats-last-updated').textContent = new Date().toLocaleTimeString('ko-KR');
    }

    updateAllCounts() {
        document.getElementById('total-keywords').textContent = this.keywords.length;
        document.getElementById('total-sites').textContent = this.sites.filter(s => s.status === 'active').length;
        document.getElementById('keyword-count-badge').textContent = `${this.keywords.length}ê°œ`;
    }

    // í‚¤ì›Œë“œ ê´€ë¦¬
    addKeyword() {
        const input = document.getElementById('keyword-input');
        const categorySelect = document.getElementById('keyword-category');
        
        const keyword = input.value.trim();
        const category = categorySelect.value;

        if (!keyword) {
            this.showMessage('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
            return;
        }

        if (this.keywords.some(k => k.text.toLowerCase() === keyword.toLowerCase())) {
            this.showMessage('ì´ë¯¸ ë“±ë¡ëœ í‚¤ì›Œë“œì…ë‹ˆë‹¤.', 'warning');
            return;
        }

        const newKeyword = {
            id: Date.now(),
            text: keyword,
            category: category,
            createdAt: new Date()
        };

        this.keywords.push(newKeyword);
        input.value = '';
        
        this.updateKeywordDisplay();
        this.updateAllCounts();
        this.showMessage(`"${keyword}" í‚¤ì›Œë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    removeKeyword(keywordId) {
        const keyword = this.keywords.find(k => k.id === keywordId);
        if (keyword) {
            this.keywords = this.keywords.filter(k => k.id !== keywordId);
            this.updateKeywordDisplay();
            this.updateAllCounts();
            this.showMessage(`"${keyword.text}" í‚¤ì›Œë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
        }
    }

    filterKeywords(category) {
        this.currentFilter = category;
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-category="${category}"]`).classList.add('active');
        
        this.updateKeywordDisplay();
    }

    updateKeywordDisplay() {
        const container = document.getElementById('keyword-tags');
        const emptyState = document.getElementById('keywords-empty-state');

        const filteredKeywords = this.currentFilter === 'all' 
            ? this.keywords 
            : this.keywords.filter(k => k.category === this.currentFilter);

        if (filteredKeywords.length === 0) {
            container.style.display = 'none';
            emptyState.classList.remove('hidden');
        } else {
            container.style.display = 'flex';
            emptyState.classList.add('hidden');
            
            container.innerHTML = filteredKeywords.map(keyword => `
                <div class="keyword-tag ${keyword.category}" data-id="${keyword.id}">
                    <span class="keyword-text">${keyword.text}</span>
                    <button class="remove-keyword" onclick="dashboard.removeKeyword(${keyword.id})" title="í‚¤ì›Œë“œ ì‚­ì œ">
                        âœ•
                    </button>
                </div>
            `).join('');
        }
    }

    // ì‚¬ì´íŠ¸ ê´€ë¦¬
    handleFileUpload(files) {
        for (let file of files) {
            if (this.validateFile(file)) {
                this.processExcelFile(file);
            }
        }
    }

    validateFile(file) {
        const validTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 
                           'application/vnd.ms-excel'];
        const maxSize = 10 * 1024 * 1024; // 10MB

        if (!validTypes.includes(file.type)) {
            this.showMessage('Excel íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
            return false;
        }

        if (file.size > maxSize) {
            this.showMessage('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
            return false;
        }

        return true;
    }

    async processExcelFile(file) {
        // Excel íŒŒì¼ ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
        const newSites = [
            {
                name: 'ê³¼í•™ê¸°ìˆ ì •ë³´í†µì‹ ë¶€',
                url: 'https://www.msit.go.kr',
                type: 'government',
                description: 'ê³¼í•™ê¸°ìˆ ì •ë³´í†µì‹  ì •ì±… ë¶€ì²˜',
                status: 'active'
            }
        ];

        this.addSites(newSites);
        this.showMessage(`${newSites.length}ê°œì˜ ì‚¬ì´íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    }

    addSites(sites) {
        sites.forEach(site => {
            const newSite = {
                id: Date.now() + Math.random(),
                ...site,
                createdAt: new Date()
            };
            this.sites.push(newSite);
        });
        
        this.updateSiteDisplay();
        this.updateAllCounts();
    }

    updateSiteDisplay() {
        const container = document.getElementById('sites-grid');
        const emptyState = document.getElementById('sites-empty-state');

        if (this.sites.length === 0) {
            container.style.display = 'none';
            emptyState.classList.remove('hidden');
        } else {
            container.style.display = 'grid';
            emptyState.classList.add('hidden');
            
            container.innerHTML = this.sites.map(site => this.createSiteCard(site)).join('');
        }
    }

    createSiteCard(site) {
        const typeNames = {
            government: 'ì •ë¶€ê¸°ê´€',
            news: 'ì–¸ë¡ ì‚¬',
            tech: 'ê¸°ìˆ ë¸”ë¡œê·¸',
            research: 'ì—°êµ¬ê¸°ê´€'
        };

        const statusNames = {
            active: 'í™œì„±',
            inactive: 'ë¹„í™œì„±',
            error: 'ì˜¤ë¥˜'
        };

        return `
            <div class="site-card" data-id="${site.id}">
                <div class="site-header">
                    <div class="site-info">
                        <div class="site-name">${site.name}</div>
                        <a href="${site.url}" target="_blank" class="site-url">${site.url}</a>
                    </div>
                    <div class="site-status ${site.status}">${statusNames[site.status]}</div>
                </div>
                <div class="site-meta">
                    <span class="site-type ${site.type}">${typeNames[site.type]}</span>
                    <span class="site-created">ë“±ë¡: ${new Date(site.createdAt).toLocaleDateString()}</span>
                </div>
                ${site.description ? `<div class="site-description">${site.description}</div>` : ''}
                <div class="site-actions">
                    <button class="btn-test" onclick="dashboard.testSite(${site.id})">í…ŒìŠ¤íŠ¸</button>
                    <button class="btn-edit" onclick="dashboard.editSite(${site.id})">ìˆ˜ì •</button>
                    <button class="btn-delete" onclick="dashboard.deleteSite(${site.id})">ì‚­ì œ</button>
                </div>
            </div>
        `;
    }

    // í¬ë¡¤ë§ ì‹¤í–‰
    async startWeeklyCrawling() {
        if (this.isRunning) return;

        if (this.keywords.length === 0) {
            this.showMessage('í¬ë¡¤ë§í•  í‚¤ì›Œë“œë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.', 'warning');
            return;
        }

        if (this.sites.filter(s => s.status === 'active').length === 0) {
            this.showMessage('í™œì„±í™”ëœ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
            return;
        }

        this.isRunning = true;
        this.showCrawlingProgress();
        this.updateCrawlingStatus('running', 'í¬ë¡¤ë§ ì‹œì‘');
        
        try {
            await this.performCrawling();
            this.completeCrawling();
        } catch (error) {
            this.handleCrawlingError(error);
        }
    }

    showCrawlingProgress() {
        document.getElementById('crawling-progress-card').classList.remove('hidden');
        document.getElementById('start-weekly-crawling-btn').disabled = true;
        document.getElementById('start-weekly-crawling-btn').innerHTML = 
            '<i class="icon">â³</i><span class="btn-text">í¬ë¡¤ë§ ì§„í–‰ì¤‘...</span>';
    }

    updateCrawlingStatus(status, message) {
        const indicator = document.getElementById('crawling-status-indicator');
        const dot = indicator.querySelector('.status-dot');
        const text = indicator.querySelector('.status-text');
        
        dot.className = `status-dot ${status}`;
        text.textContent = message;
    }

    async performCrawling() {
        const activeSites = this.sites.filter(s => s.status === 'active');
        const totalTasks = activeSites.length * this.keywords.length;
        let completedTasks = 0;
        let collectedArticles = 0;

        document.getElementById('total-sites-progress').textContent = activeSites.length;

        // ê²½ê³¼ ì‹œê°„ íƒ€ì´ë¨¸ ì‹œì‘
        const startTime = Date.now();
        const timer = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('elapsed-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);

        for (let siteIndex = 0; siteIndex < activeSites.length; siteIndex++) {
            if (!this.isRunning) break;

            const site = activeSites[siteIndex];
            document.getElementById('current-status').textContent = `${site.name} ì²˜ë¦¬ ì¤‘...`;
            
            for (let keyword of this.keywords) {
                if (!this.isRunning) break;

                // í¬ë¡¤ë§ ì‹œë®¬ë ˆì´ì…˜
                await this.sleep(500);
                
                completedTasks++;
                collectedArticles += Math.floor(Math.random() * 3) + 1;
                
                const progress = Math.round((completedTasks / totalTasks) * 100);
                this.updateProgress(progress, siteIndex + 1, collectedArticles);
            }
        }

        clearInterval(timer);
    }

    updateProgress(percentage, processedSites, collectedArticles) {
        document.getElementById('overall-progress-fill').style.width = percentage + '%';
        document.getElementById('overall-percentage').textContent = percentage + '%';
        document.getElementById('processed-sites').textContent = processedSites;
        document.getElementById('collected-articles').textContent = collectedArticles;
        
        const successRate = Math.min(Math.round((collectedArticles / (processedSites * this.keywords.length)) * 100), 100);
        document.getElementById('success-rate').textContent = successRate + '%';
    }

    completeCrawling() {
        this.isRunning = false;
        this.updateCrawlingStatus('completed', 'í¬ë¡¤ë§ ì™„ë£Œ');
        
        // ë²„íŠ¼ ë³µì›
        document.getElementById('start-weekly-crawling-btn').disabled = false;
        document.getElementById('start-weekly-crawling-btn').innerHTML = 
            '<i class="icon">ğŸš€</i><span class="btn-text">ì£¼ê°„ í¬ë¡¤ë§ ì‹œì‘</span>';
        
        // ë§ˆì§€ë§‰ ì‹¤í–‰ ì‹œê°„ ì—…ë°ì´íŠ¸
        document.getElementById('last-crawl-date').textContent = new Date().toLocaleDateString();
        
        this.showMessage('ì£¼ê°„ í¬ë¡¤ë§ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        
        // í†µê³„ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
            this.loadStats();
        }, 1000);
    }

    handleCrawlingError(error) {
        this.isRunning = false;
        this.updateCrawlingStatus('error', 'í¬ë¡¤ë§ ì˜¤ë¥˜');
        this.showMessage('í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
    }

    // ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œ
    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    showMessage(message, type = 'info') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'rgb(152, 195, 121)' : 
                        type === 'error' ? 'rgb(224, 108, 117)' : 
                        type === 'warning' ? 'rgb(229, 192, 123)' : 'rgb(86, 182, 194)'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        `;
        
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    // ì‚¬ì´íŠ¸ ì•¡ì…˜
    testSite(siteId) {
        const site = this.sites.find(s => s.id === siteId);
        if (site) {
            this.showMessage(`${site.name} ì‚¬ì´íŠ¸ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸ ì¤‘...`, 'info');
        }
    }

    editSite(siteId) {
        console.log('Edit site:', siteId);
    }

    deleteSite(siteId) {
        if (confirm('ì •ë§ë¡œ ì´ ì‚¬ì´íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            this.sites = this.sites.filter(s => s.id !== siteId);
            this.updateSiteDisplay();
            this.updateAllCounts();
            this.showMessage('ì‚¬ì´íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
    }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
let dashboard;

// ì™¸ë¶€ í•¨ìˆ˜ë“¤
function refreshAllStats() {
    if (dashboard) {
        dashboard.loadStats();
        dashboard.showMessage('í†µê³„ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
    }
}

function startWeeklyCrawling() {
    if (dashboard) {
        dashboard.startWeeklyCrawling();
    }
}

function pauseCrawling() {
    if (dashboard && dashboard.isRunning) {
        dashboard.isRunning = false;
        dashboard.updateCrawlingStatus('paused', 'ì¼ì‹œì •ì§€ë¨');
        dashboard.showMessage('í¬ë¡¤ë§ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
    }
}

function stopCrawling() {
    if (dashboard && dashboard.isRunning) {
        if (confirm('ì •ë§ë¡œ í¬ë¡¤ë§ì„ ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            dashboard.isRunning = false;
            dashboard.updateCrawlingStatus('idle', 'ëŒ€ê¸°ì¤‘');
            document.getElementById('crawling-progress-card').classList.add('hidden');
            document.getElementById('start-weekly-crawling-btn').disabled = false;
            document.getElementById('start-weekly-crawling-btn').innerHTML = 
                '<i class="icon">ğŸš€</i><span class="btn-text">ì£¼ê°„ í¬ë¡¤ë§ ì‹œì‘</span>';
            dashboard.showMessage('í¬ë¡¤ë§ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
        }
    }
}

function switchSettingsTab(tabName) {
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.settings-content').forEach(content => {
        content.classList.remove('active');
    });
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-settings').classList.add('active');
}

function addKeyword() {
    if (dashboard) {
        dashboard.addKeyword();
    }
}

function filterKeywords(category) {
    if (dashboard) {
        dashboard.filterKeywords(category);
    }
}

function filterSites() {
    // ì‚¬ì´íŠ¸ í•„í„°ë§ ë¡œì§ (í•„ìš”ì‹œ êµ¬í˜„)
}

function downloadTemplate() {
    dashboard.showMessage('Excel í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.', 'info');
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í…œí”Œë¦¿ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
}

function openAddSiteModal() {
    document.getElementById('add-site-modal').classList.remove('hidden');
}

function closeAddSiteModal() {
    document.getElementById('add-site-modal').classList.add('hidden');
    // í¼ ì´ˆê¸°í™”
    document.getElementById('manual-site-name').value = '';
    document.getElementById('manual-site-url').value = '';
    document.getElementById('manual-site-type').value = 'government';
    document.getElementById('manual-site-description').value = '';
}

function addSiteManually() {
    const name = document.getElementById('manual-site-name').value.trim();
    const url = document.getElementById('manual-site-url').value.trim();
    const type = document.getElementById('manual-site-type').value;
    const description = document.getElementById('manual-site-description').value.trim();

    if (!name || !url) {
        dashboard.showMessage('ì‚¬ì´íŠ¸ëª…ê³¼ URLì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', 'error');
        return;
    }

    const newSite = {
        name,
        url,
        type,
        description,
        status: 'active'
    };

    dashboard.addSites([newSite]);
    closeAddSiteModal();
    dashboard.showMessage('ì‚¬ì´íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
}

function viewAllResults() {
    dashboard.showMessage('ì „ì²´ í¬ë¡¤ë§ ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'info');
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    dashboard = new IntegratedDashboard();
});

// ìŠ¬ë¼ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
