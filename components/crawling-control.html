<!-- í¬ë¡¤ë§ ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§ ì»´í¬ë„ŒíŠ¸ -->
<div class="crawling-control-component">
    <div class="component-header">
        <h4 class="component-title">í¬ë¡¤ë§ ì‹¤í–‰ ë° ëª¨ë‹ˆí„°ë§</h4>
        <div class="component-description">
            ë“±ë¡ëœ í‚¤ì›Œë“œì™€ ì‚¬ì´íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì£¼ê°„ í¬ë¡¤ë§ì„ ì‹¤í–‰í•˜ê³  ì§„í–‰ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
        </div>
    </div>

    <!-- í¬ë¡¤ë§ ì‹¤í–‰ ì»¨íŠ¸ë¡¤ -->
    <div class="crawling-control-section">
        <div class="control-header">
            <div class="control-info">
                <h5 class="control-title">ì£¼ê°„ í¬ë¡¤ë§ ì‹¤í–‰</h5>
                <div class="control-subtitle">ë“±ë¡ëœ ëª¨ë“  í‚¤ì›Œë“œì™€ ì‚¬ì´íŠ¸ë¥¼ ëŒ€ìƒìœ¼ë¡œ í¬ë¡¤ë§ì„ ì‹œì‘í•©ë‹ˆë‹¤.</div>
            </div>
            <button class="btn-start-crawling" id="start-crawling-btn" onclick="startWeeklyCrawling()">
                <i class="icon">ğŸš€</i>
                <span>í¬ë¡¤ë§ ì‹œì‘</span>
            </button>
        </div>

        <!-- í¬ë¡¤ë§ ì„¤ì • ìš”ì•½ -->
        <div class="crawling-summary">
            <div class="summary-item">
                <div class="summary-label">ë“±ë¡ëœ í‚¤ì›Œë“œ</div>
                <div class="summary-value" id="keywords-count">5ê°œ</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">ëŒ€ìƒ ì‚¬ì´íŠ¸</div>
                <div class="summary-value" id="sites-count">12ê°œ</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">ì˜ˆìƒ ì†Œìš”ì‹œê°„</div>
                <div class="summary-value" id="estimated-time">15-20ë¶„</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">ë§ˆì§€ë§‰ ì‹¤í–‰</div>
                <div class="summary-value" id="last-crawl">2024.01.08</div>
            </div>
        </div>
    </div>

    <!-- í¬ë¡¤ë§ ì§„í–‰ ìƒí™© -->
    <div class="crawling-progress-section hidden" id="crawling-progress-section">
        <div class="progress-header">
            <h5 class="progress-title">í¬ë¡¤ë§ ì§„í–‰ ìƒí™©</h5>
            <div class="progress-status" id="progress-status">
                <span class="status-indicator running" id="status-indicator">ì§„í–‰ì¤‘</span>
                <span class="elapsed-time" id="elapsed-time">00:00</span>
            </div>
        </div>

        <!-- ì „ì²´ ì§„í–‰ë¥  -->
        <div class="overall-progress">
            <div class="progress-info">
                <span class="progress-label">ì „ì²´ ì§„í–‰ë¥ </span>
                <span class="progress-percentage" id="overall-percentage">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress-fill"></div>
            </div>
        </div>

        <!-- í˜„ì¬ ì‘ì—… ì •ë³´ -->
        <div class="current-task">
            <div class="task-info">
                <div class="task-label">í˜„ì¬ ì‘ì—…</div>
                <div class="task-description" id="current-task-description">í¬ë¡¤ë§ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
            </div>
            <div class="task-details">
                <span class="current-keyword" id="current-keyword"></span>
                <span class="current-site" id="current-site"></span>
            </div>
        </div>

        <!-- ì„¸ë¶€ ì§„í–‰ ìƒí™© -->
        <div class="detailed-progress">
            <div class="progress-grid">
                <div class="progress-item">
                    <div class="progress-item-label">ì‚¬ì´íŠ¸ ì²˜ë¦¬</div>
                    <div class="progress-item-value">
                        <span id="sites-processed">0</span> / <span id="sites-total">0</span>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-item-label">í‚¤ì›Œë“œ ì²˜ë¦¬</div>
                    <div class="progress-item-value">
                        <span id="keywords-processed">0</span> / <span id="keywords-total">0</span>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-item-label">ìˆ˜ì§‘ëœ ê¸°ì‚¬</div>
                    <div class="progress-item-value" id="articles-collected">0</div>
                </div>
                <div class="progress-item">
                    <div class="progress-item-label">ì„±ê³µë¥ </div>
                    <div class="progress-item-value" id="success-rate">0%</div>
                </div>
            </div>
        </div>

        <!-- í¬ë¡¤ë§ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
        <div class="crawling-controls">
            <button class="btn-pause" id="pause-btn" onclick="pauseCrawling()">
                <i class="icon">â¸ï¸</i>
                ì¼ì‹œì •ì§€
            </button>
            <button class="btn-stop" id="stop-btn" onclick="stopCrawling()">
                <i class="icon">â¹ï¸</i>
                ì¤‘ì§€
            </button>
        </div>
    </div>

    <!-- í¬ë¡¤ë§ ê²°ê³¼ -->
    <div class="crawling-results-section hidden" id="crawling-results-section">
        <div class="results-header">
            <h5 class="results-title">í¬ë¡¤ë§ ê²°ê³¼</h5>
            <div class="results-meta">
                <span class="results-count" id="results-count">0ê°œ ê¸°ì‚¬ ìˆ˜ì§‘</span>
                <span class="results-time" id="results-time">-</span>
            </div>
        </div>

        <!-- ê²°ê³¼ í†µê³„ -->
        <div class="results-stats">
            <div class="stat-item">
                <div class="stat-value" id="total-articles">0</div>
                <div class="stat-label">ì´ ìˆ˜ì§‘ ê¸°ì‚¬</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successful-sites">0</div>
                <div class="stat-label">ì„±ê³µí•œ ì‚¬ì´íŠ¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="processing-time">0ë¶„</div>
                <div class="stat-label">ì²˜ë¦¬ ì‹œê°„</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="success-percentage">0%</div>
                <div class="stat-label">ì „ì²´ ì„±ê³µë¥ </div>
            </div>
        </div>

        <!-- ìˆ˜ì§‘ëœ ê¸°ì‚¬ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="articles-preview">
            <div class="preview-header">
                <span class="preview-title">ìˆ˜ì§‘ëœ ê¸°ì‚¬ ë¯¸ë¦¬ë³´ê¸°</span>
                <button class="btn-view-all" onclick="viewAllArticles()">ì „ì²´ ë³´ê¸°</button>
            </div>
            <div class="articles-list" id="articles-preview-list">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê¸°ì‚¬ ëª©ë¡ -->
            </div>
        </div>

        <!-- ê²°ê³¼ ì•¡ì…˜ -->
        <div class="results-actions">
            <button class="btn-export" onclick="exportResults()">
                <i class="icon">ğŸ“Š</i>
                ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
            </button>
            <button class="btn-clear" onclick="clearResults()">
                <i class="icon">ğŸ—‘ï¸</i>
                ê²°ê³¼ ì§€ìš°ê¸°
            </button>
            <button class="btn-new-crawl" onclick="startNewCrawling()">
                <i class="icon">ğŸ”„</i>
                ìƒˆ í¬ë¡¤ë§ ì‹œì‘
            </button>
        </div>
    </div>

    <!-- í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ -->
    <div class="crawling-history-section">
        <div class="history-header">
            <h5 class="history-title">ìµœê·¼ í¬ë¡¤ë§ ê¸°ë¡</h5>
            <button class="btn-view-history" onclick="viewFullHistory()">ì „ì²´ ê¸°ë¡ ë³´ê¸°</button>
        </div>
        <div class="history-list" id="crawling-history-list">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” íˆìŠ¤í† ë¦¬ ëª©ë¡ -->
        </div>
    </div>
</div>

<style>
/* í¬ë¡¤ë§ ì»¨íŠ¸ë¡¤ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ */
.crawling-control-component {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
}

.component-header {
    margin-bottom: 32px;
}

.component-title {
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.component-description {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* í¬ë¡¤ë§ ì‹¤í–‰ ì»¨íŠ¸ë¡¤ */
.crawling-control-section {
    margin-bottom: 32px;
}

.control-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
}

.control-info {
    flex: 1;
}

.control-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.control-subtitle {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

.btn-start-crawling {
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    color: white;
    border: none;
    border-radius: 12px;
    padding: 16px 24px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(198, 120, 221, 0.3);
}

.btn-start-crawling:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(198, 120, 221, 0.4);
}

.btn-start-crawling:disabled {
    background: rgba(171, 178, 191, 0.3);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.btn-start-crawling .icon {
    font-size: 1.2rem;
}

/* í¬ë¡¤ë§ ì„¤ì • ìš”ì•½ */
.crawling-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
}

.summary-item {
    text-align: center;
}

.summary-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 8px;
}

.summary-value {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

/* í¬ë¡¤ë§ ì§„í–‰ ìƒí™© */
.crawling-progress-section {
    background: rgba(86, 182, 194, 0.1);
    border: 1px solid rgba(86, 182, 194, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 32px;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.progress-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.progress-status {
    display: flex;
    align-items: center;
    gap: 12px;
}

.status-indicator {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-indicator.running {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
    animation: pulse 2s infinite;
}

.status-indicator.paused {
    background: rgba(229, 192, 123, 0.2);
    color: rgb(229, 192, 123);
}

.status-indicator.completed {
    background: rgba(86, 182, 194, 0.2);
    color: rgb(86, 182, 194);
}

.elapsed-time {
    color: rgb(171, 178, 191);
    font-family: monospace;
    font-size: 0.9rem;
}

/* ì „ì²´ ì§„í–‰ë¥  */
.overall-progress {
    margin-bottom: 20px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-label {
    color: white;
    font-weight: 500;
}

.progress-percentage {
    color: rgb(86, 182, 194);
    font-weight: 600;
    font-size: 1.1rem;
}

.progress-bar {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    height: 12px;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, rgb(86, 182, 194), rgb(198, 120, 221));
    height: 100%;
    width: 0%;
    border-radius: 8px;
    transition: width 0.5s ease;
}

/* í˜„ì¬ ì‘ì—… ì •ë³´ */
.current-task {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 20px;
}

.task-info {
    margin-bottom: 8px;
}

.task-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 4px;
}

.task-description {
    color: white;
    font-weight: 500;
}

.task-details {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.current-keyword, .current-site {
    padding: 2px 8px;
    background: rgba(198, 120, 221, 0.2);
    border-radius: 4px;
    color: rgb(198, 120, 221);
}

/* ì„¸ë¶€ ì§„í–‰ ìƒí™© */
.detailed-progress {
    margin-bottom: 20px;
}

.progress-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 16px;
}

.progress-item {
    text-align: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.progress-item-label {
    color: rgb(171, 178, 191);
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.progress-item-value {
    color: white;
    font-weight: 600;
    font-size: 1rem;
}

/* í¬ë¡¤ë§ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
.crawling-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.btn-pause, .btn-stop {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgb(171, 178, 191);
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-pause:hover {
    background: rgba(229, 192, 123, 0.2);
    border-color: rgba(229, 192, 123, 0.3);
    color: rgb(229, 192, 123);
}

.btn-stop:hover {
    background: rgba(224, 108, 117, 0.2);
    border-color: rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
}

/* í¬ë¡¤ë§ ê²°ê³¼ */
.crawling-results-section {
    background: rgba(198, 120, 221, 0.1);
    border: 1px solid rgba(198, 120, 221, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 32px;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.results-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.results-meta {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

/* ê²°ê³¼ í†µê³„ */
.results-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.stat-item {
    text-align: center;
    padding: 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.stat-value {
    color: rgb(198, 120, 221);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 4px;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* ê¸°ì‚¬ ë¯¸ë¦¬ë³´ê¸° */
.articles-preview {
    margin-bottom: 24px;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.preview-title {
    color: white;
    font-weight: 500;
}

.btn-view-all {
    background: rgba(198, 120, 221, 0.2);
    border: 1px solid rgba(198, 120, 221, 0.3);
    color: rgb(198, 120, 221);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
}

.articles-list {
    max-height: 300px;
    overflow-y: auto;
}

.article-preview-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
    transition: all 0.2s ease;
}

.article-preview-item:hover {
    background: rgba(255, 255, 255, 0.08);
}

.article-preview-title {
    color: white;
    font-weight: 500;
    font-size: 0.95rem;
    margin-bottom: 4px;
    line-height: 1.4;
}

.article-preview-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: rgb(171, 178, 191);
}

/* ê²°ê³¼ ì•¡ì…˜ */
.results-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn-export, .btn-clear, .btn-new-crawl {
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.btn-export {
    background: rgba(152, 195, 121, 0.2);
    border: 1px solid rgba(152, 195, 121, 0.3);
    color: rgb(152, 195, 121);
}

.btn-clear {
    background: rgba(224, 108, 117, 0.2);
    border: 1px solid rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
}

.btn-new-crawl {
    background: rgb(198, 120, 221);
    border: none;
    color: white;
}

/* í¬ë¡¤ë§ íˆìŠ¤í† ë¦¬ */
.crawling-history-section {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 24px;
}

.history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.history-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.btn-view-history {
    background: rgba(86, 182, 194, 0.2);
    border: 1px solid rgba(86, 182, 194, 0.3);
    color: rgb(86, 182, 194);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.history-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-info {
    flex: 1;
}

.history-date {
    color: white;
    font-weight: 500;
    margin-bottom: 4px;
}

.history-details {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

.history-status {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.history-status.success {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
}

.history-status.failed {
    background: rgba(224, 108, 117, 0.2);
    color: rgb(224, 108, 117);
}

/* ìœ í‹¸ë¦¬í‹° */
.hidden {
    display: none !important;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .control-header {
        flex-direction: column;
        gap: 16px;
    }
    
    .crawling-summary {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .progress-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .results-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .results-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .history-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
}
</style>

<script>
// í¬ë¡¤ë§ ì»¨íŠ¸ë¡¤ ì»´í¬ë„ŒíŠ¸ JavaScript
class CrawlingController {
    constructor() {
        this.isRunning = false;
        this.isPaused = false;
        this.currentJob = null;
        this.startTime = null;
        this.elapsedInterval = null;
        this.progressInterval = null;
        this.init();
    }

    init() {
        this.loadHistory();
        this.updateSummary();
    }

    async startWeeklyCrawling() {
        if (this.isRunning) return;

        this.isRunning = true;
        this.startTime = new Date();
        
        // UI ì—…ë°ì´íŠ¸
        this.showProgressSection();
        this.disableStartButton();
        this.startElapsedTimer();
        
        // í¬ë¡¤ë§ ì‘ì—… ì‹œì‘
        this.currentJob = {
            id: Date.now(),
            startTime: this.startTime,
            totalSites: 12, // ì˜ˆì‹œ ê°’
            totalKeywords: 5, // ì˜ˆì‹œ ê°’
            processedSites: 0,
            processedKeywords: 0,
            collectedArticles: 0,
            errors: []
        };

        try {
            await this.performCrawling();
        } catch (error) {
            this.handleCrawlingError(error);
        }
    }

    async performCrawling() {
        const sites = ['í•œêµ­ë°©ì†¡í†µì‹ ìœ„ì›íšŒ', 'ì „ìì‹ ë¬¸', 'ë„¤ì´ë²„ë‰´ìŠ¤', 'ì—°í•©ë‰´ìŠ¤']; // ì˜ˆì‹œ
        const keywords = ['ì „íŒŒ', 'ì£¼íŒŒìˆ˜', '6G', 'AI', 'ì •ì±…']; // ì˜ˆì‹œ
        
        let totalTasks = sites.length * keywords.length;
        let completedTasks = 0;

        for (let siteIndex = 0; siteIndex < sites.length; siteIndex++) {
            if (!this.isRunning) break;
            
            const site = sites[siteIndex];
            this.updateCurrentTask(`${site} ì‚¬ì´íŠ¸ ì²˜ë¦¬ ì¤‘...`);
            
            for (let keywordIndex = 0; keywordIndex < keywords.length; keywordIndex++) {
                if (!this.isRunning) break;
                
                const keyword = keywords[keywordIndex];
                this.updateCurrentTask(`${site}ì—ì„œ "${keyword}" í‚¤ì›Œë“œ í¬ë¡¤ë§ ì¤‘...`, keyword, site);
                
                // í¬ë¡¤ë§ ì‹œë®¬ë ˆì´ì…˜
                await this.simulateCrawling();
                
                completedTasks++;
                const progress = Math.round((completedTasks / totalTasks) * 100);
                this.updateProgress(progress);
                
                // ìˆ˜ì§‘ëœ ê¸°ì‚¬ ìˆ˜ ì¦ê°€ ì‹œë®¬ë ˆì´ì…˜
                this.currentJob.collectedArticles += Math.floor(Math.random() * 5) + 1;
                this.updateDetailedProgress();
                
                // ì ì‹œ ëŒ€ê¸° (ì‹¤ì œë¡œëŠ” API ì‘ë‹µ ëŒ€ê¸°)
                await this.sleep(500);
            }
            
            this.currentJob.processedSites++;
            this.currentJob.processedKeywords = keywords.length;
        }

        if (this.isRunning) {
            this.completeCrawling();
        }
    }

    async simulateCrawling() {
        // ì‹¤ì œ í¬ë¡¤ë§ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
        return new Promise(resolve => {
            setTimeout(resolve, Math.random() * 1000 + 500);
        });
    }

    completeCrawling() {
        this.isRunning = false;
        this.stopElapsedTimer();
        
        // ê²°ê³¼ ìƒì„±
        const results = this.generateResults();
        
        // UI ì—…ë°ì´íŠ¸
        this.hideProgressSection();
        this.showResultsSection(results);
        this.enableStartButton();
        
        // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        this.addToHistory(results);
        
        this.showMessage('í¬ë¡¤ë§ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
    }

    pauseCrawling() {
        if (!this.isRunning || this.isPaused) return;
        
        this.isPaused = true;
        this.stopElapsedTimer();
        
        const statusIndicator = document.getElementById('status-indicator');
        statusIndicator.textContent = 'ì¼ì‹œì •ì§€';
        statusIndicator.className = 'status-indicator paused';
        
        document.getElementById('pause-btn').innerHTML = '<i class="icon">â–¶ï¸</i> ì¬ì‹œì‘';
        document.getElementById('pause-btn').onclick = () => this.resumeCrawling();
        
        this.showMessage('í¬ë¡¤ë§ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
    }

    resumeCrawling() {
        if (!this.isRunning || !this.isPaused) return;
        
        this.isPaused = false;
        this.startElapsedTimer();
        
        const statusIndicator = document.getElementById('status-indicator');
        statusIndicator.textContent = 'ì§„í–‰ì¤‘';
        statusIndicator.className = 'status-indicator running';
        
        document.getElementById('pause-btn').innerHTML = '<i class="icon">â¸ï¸</i> ì¼ì‹œì •ì§€';
        document.getElementById('pause-btn').onclick = () => this.pauseCrawling();
        
        this.showMessage('í¬ë¡¤ë§ì´ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
    }

    stopCrawling() {
        if (!this.isRunning) return;
        
        if (confirm('ì •ë§ë¡œ í¬ë¡¤ë§ì„ ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ëª¨ë‘ ì·¨ì†Œë©ë‹ˆë‹¤.')) {
            this.isRunning = false;
            this.isPaused = false;
            this.stopElapsedTimer();
            
            this.hideProgressSection();
            this.enableStartButton();
            
            this.showMessage('í¬ë¡¤ë§ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
        }
    }

    updateProgress(percentage) {
        const progressFill = document.getElementById('overall-progress-fill');
        const progressPercentage = document.getElementById('overall-percentage');
        
        progressFill.style.width = percentage + '%';
        progressPercentage.textContent = percentage + '%';
    }

    updateCurrentTask(description, keyword = '', site = '') {
        document.getElementById('current-task-description').textContent = description;
        document.getElementById('current-keyword').textContent = keyword;
        document.getElementById('current-site').textContent = site;
    }

    updateDetailedProgress() {
        if (!this.currentJob) return;
        
        document.getElementById('sites-processed').textContent = this.currentJob.processedSites;
        document.getElementById('sites-total').textContent = this.currentJob.totalSites;
        document.getElementById('keywords-processed').textContent = this.currentJob.processedKeywords;
        document.getElementById('keywords-total').textContent = this.currentJob.totalKeywords;
        document.getElementById('articles-collected').textContent = this.currentJob.collectedArticles;
        
        const successRate = Math.round((this.currentJob.collectedArticles / 
            (this.currentJob.processedSites * this.currentJob.totalKeywords || 1)) * 100);
        document.getElementById('success-rate').textContent = successRate + '%';
    }

    startElapsedTimer() {
        this.elapsedInterval = setInterval(() => {
            const elapsed = new Date() - this.startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('elapsed-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    stopElapsedTimer() {
        if (this.elapsedInterval) {
            clearInterval(this.elapsedInterval);
            this.elapsedInterval = null;
        }
    }

    showProgressSection() {
        document.getElementById('crawling-progress-section').classList.remove('hidden');
    }

    hideProgressSection() {
        document.getElementById('crawling-progress-section').classList.add('hidden');
    }

    showResultsSection(results) {
        const section = document.getElementById('crawling-results-section');
        section.classList.remove('hidden');
        
        // ê²°ê³¼ ë°ì´í„° ì—…ë°ì´íŠ¸
        document.getElementById('results-count').textContent = `${results.totalArticles}ê°œ ê¸°ì‚¬ ìˆ˜ì§‘`;
        document.getElementById('results-time').textContent = results.duration;
        document.getElementById('total-articles').textContent = results.totalArticles;
        document.getElementById('successful-sites').textContent = results.successfulSites;
        document.getElementById('processing-time').textContent = results.processingTime;
        document.getElementById('success-percentage').textContent = results.successRate + '%';
        
        // ê¸°ì‚¬ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
        this.generateArticlesPreviews(results.articles);
    }

    generateResults() {
        const endTime = new Date();
        const duration = Math.round((endTime - this.startTime) / 1000 / 60); // ë¶„
        
        return {
            id: this.currentJob.id,
            startTime: this.startTime,
            endTime: endTime,
            duration: `${duration}ë¶„`,
            processingTime: `${duration}ë¶„`,
            totalArticles: this.currentJob.collectedArticles,
            successfulSites: this.currentJob.processedSites,
            successRate: Math.round((this.currentJob.collectedArticles / 
                (this.currentJob.totalSites * this.currentJob.totalKeywords)) * 100),
            articles: this.generateSampleArticles()
        };
    }

    generateSampleArticles() {
        const sampleArticles = [
            {
                title: '6G ìƒìš©í™” ë¡œë“œë§µ ë°œí‘œ, 2030ë…„ ëª©í‘œ ì„¤ì •',
                source: 'KCA ë‰´ìŠ¤',
                date: new Date().toLocaleDateString(),
                url: 'https://example.com/news1'
            },
            {
                title: 'ì „íŒŒ ì •ì±… ê°œì„ ì•ˆ, ì£¼íŒŒìˆ˜ íš¨ìœ¨ì„± ì œê³  ë°©ì•ˆ ë§ˆë ¨',
                source: 'ì „ìì‹ ë¬¸',
                date: new Date().toLocaleDateString(),
                url: 'https://example.com/news2'
            },
            {
                title: 'AI ê¸°ë°˜ ìŠ¤í™íŠ¸ëŸ¼ ê´€ë¦¬ ì‹œìŠ¤í…œ ë„ì… ê³„íš',
                source: 'ì—°í•©ë‰´ìŠ¤',
                date: new Date().toLocaleDateString(),
                url: 'https://example.com/news3'
            }
        ];
        
        return sampleArticles.slice(0, Math.min(this.currentJob.collectedArticles, 10));
    }

    generateArticlesPreviews(articles) {
        const container = document.getElementById('articles-preview-list');
        
        container.innerHTML = articles.map(article => `
            <div class="article-preview-item">
                <div class="article-preview-title">${article.title}</div>
                <div class="article-preview-meta">
                    <span>${article.source}</span>
                    <span>${article.date}</span>
                </div>
            </div>
        `).join('');
    }

    disableStartButton() {
        const btn = document.getElementById('start-crawling-btn');
        btn.disabled = true;
        btn.innerHTML = '<i class="icon">â³</i><span>í¬ë¡¤ë§ ì§„í–‰ì¤‘...</span>';
    }

    enableStartButton() {
        const btn = document.getElementById('start-crawling-btn');
        btn.disabled = false;
        btn.innerHTML = '<i class="icon">ğŸš€</i><span>í¬ë¡¤ë§ ì‹œì‘</span>';
    }

    updateSummary() {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        document.getElementById('keywords-count').textContent = '5ê°œ';
        document.getElementById('sites-count').textContent = '12ê°œ';
        document.getElementById('estimated-time').textContent = '15-20ë¶„';
        document.getElementById('last-crawl').textContent = '2024.01.08';
    }

    loadHistory() {
        const historyContainer = document.getElementById('crawling-history-list');
        
        // ìƒ˜í”Œ íˆìŠ¤í† ë¦¬ ë°ì´í„°
        const sampleHistory = [
            {
                date: '2024.01.15 14:30',
                details: '5ê°œ í‚¤ì›Œë“œ, 12ê°œ ì‚¬ì´íŠ¸ â†’ 87ê°œ ê¸°ì‚¬ ìˆ˜ì§‘',
                status: 'success'
            },
            {
                date: '2024.01.08 09:15',
                details: '5ê°œ í‚¤ì›Œë“œ, 10ê°œ ì‚¬ì´íŠ¸ â†’ 72ê°œ ê¸°ì‚¬ ìˆ˜ì§‘',
                status: 'success'
            },
            {
                date: '2024.01.01 16:45',
                details: '4ê°œ í‚¤ì›Œë“œ, 8ê°œ ì‚¬ì´íŠ¸ â†’ ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜)',
                status: 'failed'
            }
        ];

        historyContainer.innerHTML = sampleHistory.map(item => `
            <div class="history-item">
                <div class="history-info">
                    <div class="history-date">${item.date}</div>
                    <div class="history-details">${item.details}</div>
                </div>
                <div class="history-status ${item.status}">
                    ${item.status === 'success' ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}
                </div>
            </div>
        `).join('');
    }

    addToHistory(results) {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì— ì €ì¥
        console.log('í¬ë¡¤ë§ ê²°ê³¼ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€:', results);
        this.loadHistory(); // íˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨
    }

    handleCrawlingError(error) {
        this.isRunning = false;
        this.stopElapsedTimer();
        this.hideProgressSection();
        this.enableStartButton();
        
        this.showMessage('í¬ë¡¤ë§ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
    }

    showMessage(message, type = 'info') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'rgb(152, 195, 121)' : 
                        type === 'error' ? 'rgb(224, 108, 117)' : 
                        type === 'warning' ? 'rgb(229, 192, 123)' : 'rgb(86, 182, 194)'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        `;
        
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
let crawlingController;

// ì™¸ë¶€ í•¨ìˆ˜ë“¤
function startWeeklyCrawling() {
    if (crawlingController) {
        crawlingController.startWeeklyCrawling();
    }
}

function pauseCrawling() {
    if (crawlingController) {
        crawlingController.pauseCrawling();
    }
}

function stopCrawling() {
    if (crawlingController) {
        crawlingController.stopCrawling();
    }
}

function clearResults() {
    document.getElementById('crawling-results-section').classList.add('hidden');
    crawlingController.showMessage('ê²°ê³¼ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.', 'info');
}

function exportResults() {
    crawlingController.showMessage('ê²°ê³¼ë¥¼ Excel íŒŒì¼ë¡œ ë‚´ë³´ë‚´ëŠ” ì¤‘...', 'info');
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Excel ë‹¤ìš´ë¡œë“œ
}

function startNewCrawling() {
    clearResults();
    startWeeklyCrawling();
}

function viewAllArticles() {
    crawlingController.showMessage('ì „ì²´ ê¸°ì‚¬ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'info');
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í˜ì´ì§€ ì´ë™
}

function viewFullHistory() {
    crawlingController.showMessage('ì „ì²´ í¬ë¡¤ë§ ê¸°ë¡ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'info');
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í˜ì´ì§€ ì´ë™
}

// ì´ˆê¸°í™”
function initCrawlingControl() {
    crawlingController = new CrawlingController();
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    if (typeof crawlingController === 'undefined') {
        initCrawlingControl();
    }
});
</script>
