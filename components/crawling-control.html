<!-- 크롤링 실행 및 모니터링 컴포넌트 -->
<div class="crawling-control-component">
    <div class="component-header">
        <h4 class="component-title">크롤링 실행 및 모니터링</h4>
        <div class="component-description">
            등록된 키워드와 사이트를 기반으로 주간 크롤링을 실행하고 진행 상황을 모니터링합니다.
        </div>
    </div>

    <!-- 크롤링 실행 컨트롤 -->
    <div class="crawling-control-section">
        <div class="control-header">
            <div class="control-info">
                <h5 class="control-title">주간 크롤링 실행</h5>
                <div class="control-subtitle">등록된 모든 키워드와 사이트를 대상으로 크롤링을 시작합니다.</div>
            </div>
            <button class="btn-start-crawling" id="start-crawling-btn" onclick="startWeeklyCrawling()">
                <i class="icon">🚀</i>
                <span>크롤링 시작</span>
            </button>
        </div>

        <!-- 크롤링 설정 요약 -->
        <div class="crawling-summary">
            <div class="summary-item">
                <div class="summary-label">등록된 키워드</div>
                <div class="summary-value" id="keywords-count">5개</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">대상 사이트</div>
                <div class="summary-value" id="sites-count">12개</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">예상 소요시간</div>
                <div class="summary-value" id="estimated-time">15-20분</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">마지막 실행</div>
                <div class="summary-value" id="last-crawl">2024.01.08</div>
            </div>
        </div>
    </div>

    <!-- 크롤링 진행 상황 -->
    <div class="crawling-progress-section hidden" id="crawling-progress-section">
        <div class="progress-header">
            <h5 class="progress-title">크롤링 진행 상황</h5>
            <div class="progress-status" id="progress-status">
                <span class="status-indicator running" id="status-indicator">진행중</span>
                <span class="elapsed-time" id="elapsed-time">00:00</span>
            </div>
        </div>

        <!-- 전체 진행률 -->
        <div class="overall-progress">
            <div class="progress-info">
                <span class="progress-label">전체 진행률</span>
                <span class="progress-percentage" id="overall-percentage">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress-fill"></div>
            </div>
        </div>

        <!-- 현재 작업 정보 -->
        <div class="current-task">
            <div class="task-info">
                <div class="task-label">현재 작업</div>
                <div class="task-description" id="current-task-description">크롤링을 준비하고 있습니다...</div>
            </div>
            <div class="task-details">
                <span class="current-keyword" id="current-keyword"></span>
                <span class="current-site" id="current-site"></span>
            </div>
        </div>

        <!-- 세부 진행 상황 -->
        <div class="detailed-progress">
            <div class="progress-grid">
                <div class="progress-item">
                    <div class="progress-item-label">사이트 처리</div>
                    <div class="progress-item-value">
                        <span id="sites-processed">0</span> / <span id="sites-total">0</span>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-item-label">키워드 처리</div>
                    <div class="progress-item-value">
                        <span id="keywords-processed">0</span> / <span id="keywords-total">0</span>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-item-label">수집된 기사</div>
                    <div class="progress-item-value" id="articles-collected">0</div>
                </div>
                <div class="progress-item">
                    <div class="progress-item-label">성공률</div>
                    <div class="progress-item-value" id="success-rate">0%</div>
                </div>
            </div>
        </div>

        <!-- 크롤링 컨트롤 버튼 -->
        <div class="crawling-controls">
            <button class="btn-pause" id="pause-btn" onclick="pauseCrawling()">
                <i class="icon">⏸️</i>
                일시정지
            </button>
            <button class="btn-stop" id="stop-btn" onclick="stopCrawling()">
                <i class="icon">⏹️</i>
                중지
            </button>
        </div>
    </div>

    <!-- 크롤링 결과 -->
    <div class="crawling-results-section hidden" id="crawling-results-section">
        <div class="results-header">
            <h5 class="results-title">크롤링 결과</h5>
            <div class="results-meta">
                <span class="results-count" id="results-count">0개 기사 수집</span>
                <span class="results-time" id="results-time">-</span>
            </div>
        </div>

        <!-- 결과 통계 -->
        <div class="results-stats">
            <div class="stat-item">
                <div class="stat-value" id="total-articles">0</div>
                <div class="stat-label">총 수집 기사</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successful-sites">0</div>
                <div class="stat-label">성공한 사이트</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="processing-time">0분</div>
                <div class="stat-label">처리 시간</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="success-percentage">0%</div>
                <div class="stat-label">전체 성공률</div>
            </div>
        </div>

        <!-- 수집된 기사 미리보기 -->
        <div class="articles-preview">
            <div class="preview-header">
                <span class="preview-title">수집된 기사 미리보기</span>
                <button class="btn-view-all" onclick="viewAllArticles()">전체 보기</button>
            </div>
            <div class="articles-list" id="articles-preview-list">
                <!-- 동적으로 생성되는 기사 목록 -->
            </div>
        </div>

        <!-- 결과 액션 -->
        <div class="results-actions">
            <button class="btn-export" onclick="exportResults()">
                <i class="icon">📊</i>
                결과 내보내기
            </button>
            <button class="btn-clear" onclick="clearResults()">
                <i class="icon">🗑️</i>
                결과 지우기
            </button>
            <button class="btn-new-crawl" onclick="startNewCrawling()">
                <i class="icon">🔄</i>
                새 크롤링 시작
            </button>
        </div>
    </div>

    <!-- 크롤링 히스토리 -->
    <div class="crawling-history-section">
        <div class="history-header">
            <h5 class="history-title">최근 크롤링 기록</h5>
            <button class="btn-view-history" onclick="viewFullHistory()">전체 기록 보기</button>
        </div>
        <div class="history-list" id="crawling-history-list">
            <!-- 동적으로 생성되는 히스토리 목록 -->
        </div>
    </div>
</div>

<style>
/* 크롤링 컨트롤 컴포넌트 스타일 */
.crawling-control-component {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
}

.component-header {
    margin-bottom: 32px;
}

.component-title {
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.component-description {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* 크롤링 실행 컨트롤 */
.crawling-control-section {
    margin-bottom: 32px;
}

.control-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
}

.control-info {
    flex: 1;
}

.control-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.control-subtitle {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

.btn-start-crawling {
    background: linear-gradient(135deg, rgb(198, 120, 221), rgb(86, 182, 194));
    color: white;
    border: none;
    border-radius: 12px;
    padding: 16px 24px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(198, 120, 221, 0.3);
}

.btn-start-crawling:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(198, 120, 221, 0.4);
}

.btn-start-crawling:disabled {
    background: rgba(171, 178, 191, 0.3);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.btn-start-crawling .icon {
    font-size: 1.2rem;
}

/* 크롤링 설정 요약 */
.crawling-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
}

.summary-item {
    text-align: center;
}

.summary-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 8px;
}

.summary-value {
    color: white;
    font-size: 1.2rem;
    font-weight: 600;
}

/* 크롤링 진행 상황 */
.crawling-progress-section {
    background: rgba(86, 182, 194, 0.1);
    border: 1px solid rgba(86, 182, 194, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 32px;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.progress-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.progress-status {
    display: flex;
    align-items: center;
    gap: 12px;
}

.status-indicator {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-indicator.running {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
    animation: pulse 2s infinite;
}

.status-indicator.paused {
    background: rgba(229, 192, 123, 0.2);
    color: rgb(229, 192, 123);
}

.status-indicator.completed {
    background: rgba(86, 182, 194, 0.2);
    color: rgb(86, 182, 194);
}

.elapsed-time {
    color: rgb(171, 178, 191);
    font-family: monospace;
    font-size: 0.9rem;
}

/* 전체 진행률 */
.overall-progress {
    margin-bottom: 20px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.progress-label {
    color: white;
    font-weight: 500;
}

.progress-percentage {
    color: rgb(86, 182, 194);
    font-weight: 600;
    font-size: 1.1rem;
}

.progress-bar {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    height: 12px;
    overflow: hidden;
}

.progress-fill {
    background: linear-gradient(90deg, rgb(86, 182, 194), rgb(198, 120, 221));
    height: 100%;
    width: 0%;
    border-radius: 8px;
    transition: width 0.5s ease;
}

/* 현재 작업 정보 */
.current-task {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 20px;
}

.task-info {
    margin-bottom: 8px;
}

.task-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
    margin-bottom: 4px;
}

.task-description {
    color: white;
    font-weight: 500;
}

.task-details {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

.current-keyword, .current-site {
    padding: 2px 8px;
    background: rgba(198, 120, 221, 0.2);
    border-radius: 4px;
    color: rgb(198, 120, 221);
}

/* 세부 진행 상황 */
.detailed-progress {
    margin-bottom: 20px;
}

.progress-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 16px;
}

.progress-item {
    text-align: center;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.progress-item-label {
    color: rgb(171, 178, 191);
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.progress-item-value {
    color: white;
    font-weight: 600;
    font-size: 1rem;
}

/* 크롤링 컨트롤 버튼 */
.crawling-controls {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.btn-pause, .btn-stop {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgb(171, 178, 191);
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-pause:hover {
    background: rgba(229, 192, 123, 0.2);
    border-color: rgba(229, 192, 123, 0.3);
    color: rgb(229, 192, 123);
}

.btn-stop:hover {
    background: rgba(224, 108, 117, 0.2);
    border-color: rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
}

/* 크롤링 결과 */
.crawling-results-section {
    background: rgba(198, 120, 221, 0.1);
    border: 1px solid rgba(198, 120, 221, 0.2);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 32px;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

.results-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.results-meta {
    display: flex;
    gap: 16px;
    font-size: 0.9rem;
    color: rgb(171, 178, 191);
}

/* 결과 통계 */
.results-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.stat-item {
    text-align: center;
    padding: 16px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.stat-value {
    color: rgb(198, 120, 221);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 4px;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* 기사 미리보기 */
.articles-preview {
    margin-bottom: 24px;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.preview-title {
    color: white;
    font-weight: 500;
}

.btn-view-all {
    background: rgba(198, 120, 221, 0.2);
    border: 1px solid rgba(198, 120, 221, 0.3);
    color: rgb(198, 120, 221);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
}

.articles-list {
    max-height: 300px;
    overflow-y: auto;
}

.article-preview-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
    transition: all 0.2s ease;
}

.article-preview-item:hover {
    background: rgba(255, 255, 255, 0.08);
}

.article-preview-title {
    color: white;
    font-weight: 500;
    font-size: 0.95rem;
    margin-bottom: 4px;
    line-height: 1.4;
}

.article-preview-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: rgb(171, 178, 191);
}

/* 결과 액션 */
.results-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
}

.btn-export, .btn-clear, .btn-new-crawl {
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.btn-export {
    background: rgba(152, 195, 121, 0.2);
    border: 1px solid rgba(152, 195, 121, 0.3);
    color: rgb(152, 195, 121);
}

.btn-clear {
    background: rgba(224, 108, 117, 0.2);
    border: 1px solid rgba(224, 108, 117, 0.3);
    color: rgb(224, 108, 117);
}

.btn-new-crawl {
    background: rgb(198, 120, 221);
    border: none;
    color: white;
}

/* 크롤링 히스토리 */
.crawling-history-section {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 24px;
}

.history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.history-title {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.btn-view-history {
    background: rgba(86, 182, 194, 0.2);
    border: 1px solid rgba(86, 182, 194, 0.3);
    color: rgb(86, 182, 194);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
    cursor: pointer;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.history-item {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.history-info {
    flex: 1;
}

.history-date {
    color: white;
    font-weight: 500;
    margin-bottom: 4px;
}

.history-details {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

.history-status {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.history-status.success {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
}

.history-status.failed {
    background: rgba(224, 108, 117, 0.2);
    color: rgb(224, 108, 117);
}

/* 유틸리티 */
.hidden {
    display: none !important;
}

/* 애니메이션 */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* 반응형 */
@media (max-width: 768px) {
    .control-header {
        flex-direction: column;
        gap: 16px;
    }
    
    .crawling-summary {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .progress-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .results-stats {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .results-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .history-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
}
</style>

<script>
// 크롤링 컨트롤 컴포넌트 JavaScript
class CrawlingController {
    constructor() {
        this.isRunning = false;
        this.isPaused = false;
        this.currentJob = null;
        this.startTime = null;
        this.elapsedInterval = null;
        this.progressInterval = null;
        this.init();
    }

    init() {
        this.loadHistory();
        this.updateSummary();
    }

    async startWeeklyCrawling() {
        if (this.isRunning) return;

        this.isRunning = true;
        this.startTime = new Date();
        
        // UI 업데이트
        this.showProgressSection();
        this.disableStartButton();
        this.startElapsedTimer();
        
        // 크롤링 작업 시작
        this.currentJob = {
            id: Date.now(),
            startTime: this.startTime,
            totalSites: 12, // 예시 값
            totalKeywords: 5, // 예시 값
            processedSites: 0,
            processedKeywords: 0,
            collectedArticles: 0,
            errors: []
        };

        try {
            await this.performCrawling();
        } catch (error) {
            this.handleCrawlingError(error);
        }
    }

    async performCrawling() {
        const sites = ['한국방송통신위원회', '전자신문', '네이버뉴스', '연합뉴스']; // 예시
        const keywords = ['전파', '주파수', '6G', 'AI', '정책']; // 예시
        
        let totalTasks = sites.length * keywords.length;
        let completedTasks = 0;

        for (let siteIndex = 0; siteIndex < sites.length; siteIndex++) {
            if (!this.isRunning) break;
            
            const site = sites[siteIndex];
            this.updateCurrentTask(`${site} 사이트 처리 중...`);
            
            for (let keywordIndex = 0; keywordIndex < keywords.length; keywordIndex++) {
                if (!this.isRunning) break;
                
                const keyword = keywords[keywordIndex];
                this.updateCurrentTask(`${site}에서 "${keyword}" 키워드 크롤링 중...`, keyword, site);
                
                // 크롤링 시뮬레이션
                await this.simulateCrawling();
                
                completedTasks++;
                const progress = Math.round((completedTasks / totalTasks) * 100);
                this.updateProgress(progress);
                
                // 수집된 기사 수 증가 시뮬레이션
                this.currentJob.collectedArticles += Math.floor(Math.random() * 5) + 1;
                this.updateDetailedProgress();
                
                // 잠시 대기 (실제로는 API 응답 대기)
                await this.sleep(500);
            }
            
            this.currentJob.processedSites++;
            this.currentJob.processedKeywords = keywords.length;
        }

        if (this.isRunning) {
            this.completeCrawling();
        }
    }

    async simulateCrawling() {
        // 실제 크롤링 API 호출 시뮬레이션
        return new Promise(resolve => {
            setTimeout(resolve, Math.random() * 1000 + 500);
        });
    }

    completeCrawling() {
        this.isRunning = false;
        this.stopElapsedTimer();
        
        // 결과 생성
        const results = this.generateResults();
        
        // UI 업데이트
        this.hideProgressSection();
        this.showResultsSection(results);
        this.enableStartButton();
        
        // 히스토리에 추가
        this.addToHistory(results);
        
        this.showMessage('크롤링이 성공적으로 완료되었습니다!', 'success');
    }

    pauseCrawling() {
        if (!this.isRunning || this.isPaused) return;
        
        this.isPaused = true;
        this.stopElapsedTimer();
        
        const statusIndicator = document.getElementById('status-indicator');
        statusIndicator.textContent = '일시정지';
        statusIndicator.className = 'status-indicator paused';
        
        document.getElementById('pause-btn').innerHTML = '<i class="icon">▶️</i> 재시작';
        document.getElementById('pause-btn').onclick = () => this.resumeCrawling();
        
        this.showMessage('크롤링이 일시정지되었습니다.', 'info');
    }

    resumeCrawling() {
        if (!this.isRunning || !this.isPaused) return;
        
        this.isPaused = false;
        this.startElapsedTimer();
        
        const statusIndicator = document.getElementById('status-indicator');
        statusIndicator.textContent = '진행중';
        statusIndicator.className = 'status-indicator running';
        
        document.getElementById('pause-btn').innerHTML = '<i class="icon">⏸️</i> 일시정지';
        document.getElementById('pause-btn').onclick = () => this.pauseCrawling();
        
        this.showMessage('크롤링이 재시작되었습니다.', 'info');
    }

    stopCrawling() {
        if (!this.isRunning) return;
        
        if (confirm('정말로 크롤링을 중지하시겠습니까? 진행 중인 작업이 모두 취소됩니다.')) {
            this.isRunning = false;
            this.isPaused = false;
            this.stopElapsedTimer();
            
            this.hideProgressSection();
            this.enableStartButton();
            
            this.showMessage('크롤링이 중지되었습니다.', 'warning');
        }
    }

    updateProgress(percentage) {
        const progressFill = document.getElementById('overall-progress-fill');
        const progressPercentage = document.getElementById('overall-percentage');
        
        progressFill.style.width = percentage + '%';
        progressPercentage.textContent = percentage + '%';
    }

    updateCurrentTask(description, keyword = '', site = '') {
        document.getElementById('current-task-description').textContent = description;
        document.getElementById('current-keyword').textContent = keyword;
        document.getElementById('current-site').textContent = site;
    }

    updateDetailedProgress() {
        if (!this.currentJob) return;
        
        document.getElementById('sites-processed').textContent = this.currentJob.processedSites;
        document.getElementById('sites-total').textContent = this.currentJob.totalSites;
        document.getElementById('keywords-processed').textContent = this.currentJob.processedKeywords;
        document.getElementById('keywords-total').textContent = this.currentJob.totalKeywords;
        document.getElementById('articles-collected').textContent = this.currentJob.collectedArticles;
        
        const successRate = Math.round((this.currentJob.collectedArticles / 
            (this.currentJob.processedSites * this.currentJob.totalKeywords || 1)) * 100);
        document.getElementById('success-rate').textContent = successRate + '%';
    }

    startElapsedTimer() {
        this.elapsedInterval = setInterval(() => {
            const elapsed = new Date() - this.startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('elapsed-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
    }

    stopElapsedTimer() {
        if (this.elapsedInterval) {
            clearInterval(this.elapsedInterval);
            this.elapsedInterval = null;
        }
    }

    showProgressSection() {
        document.getElementById('crawling-progress-section').classList.remove('hidden');
    }

    hideProgressSection() {
        document.getElementById('crawling-progress-section').classList.add('hidden');
    }

    showResultsSection(results) {
        const section = document.getElementById('crawling-results-section');
        section.classList.remove('hidden');
        
        // 결과 데이터 업데이트
        document.getElementById('results-count').textContent = `${results.totalArticles}개 기사 수집`;
        document.getElementById('results-time').textContent = results.duration;
        document.getElementById('total-articles').textContent = results.totalArticles;
        document.getElementById('successful-sites').textContent = results.successfulSites;
        document.getElementById('processing-time').textContent = results.processingTime;
        document.getElementById('success-percentage').textContent = results.successRate + '%';
        
        // 기사 미리보기 생성
        this.generateArticlesPreviews(results.articles);
    }

    generateResults() {
        const endTime = new Date();
        const duration = Math.round((endTime - this.startTime) / 1000 / 60); // 분
        
        return {
            id: this.currentJob.id,
            startTime: this.startTime,
            endTime: endTime,
            duration: `${duration}분`,
            processingTime: `${duration}분`,
            totalArticles: this.currentJob.collectedArticles,
            successfulSites: this.currentJob.processedSites,
            successRate: Math.round((this.currentJob.collectedArticles / 
                (this.currentJob.totalSites * this.currentJob.totalKeywords)) * 100),
            articles: this.generateSampleArticles()
        };
    }

    generateSampleArticles() {
        const sampleArticles = [
            {
                title: '6G 상용화 로드맵 발표, 2030년 목표 설정',
                source: 'KCA 뉴스',
                date: new Date().toLocaleDateString(),
                url: 'https://example.com/news1'
            },
            {
                title: '전파 정책 개선안, 주파수 효율성 제고 방안 마련',
                source: '전자신문',
                date: new Date().toLocaleDateString(),
                url: 'https://example.com/news2'
            },
            {
                title: 'AI 기반 스펙트럼 관리 시스템 도입 계획',
                source: '연합뉴스',
                date: new Date().toLocaleDateString(),
                url: 'https://example.com/news3'
            }
        ];
        
        return sampleArticles.slice(0, Math.min(this.currentJob.collectedArticles, 10));
    }

    generateArticlesPreviews(articles) {
        const container = document.getElementById('articles-preview-list');
        
        container.innerHTML = articles.map(article => `
            <div class="article-preview-item">
                <div class="article-preview-title">${article.title}</div>
                <div class="article-preview-meta">
                    <span>${article.source}</span>
                    <span>${article.date}</span>
                </div>
            </div>
        `).join('');
    }

    disableStartButton() {
        const btn = document.getElementById('start-crawling-btn');
        btn.disabled = true;
        btn.innerHTML = '<i class="icon">⏳</i><span>크롤링 진행중...</span>';
    }

    enableStartButton() {
        const btn = document.getElementById('start-crawling-btn');
        btn.disabled = false;
        btn.innerHTML = '<i class="icon">🚀</i><span>크롤링 시작</span>';
    }

    updateSummary() {
        // 실제 구현에서는 API에서 데이터 가져오기
        document.getElementById('keywords-count').textContent = '5개';
        document.getElementById('sites-count').textContent = '12개';
        document.getElementById('estimated-time').textContent = '15-20분';
        document.getElementById('last-crawl').textContent = '2024.01.08';
    }

    loadHistory() {
        const historyContainer = document.getElementById('crawling-history-list');
        
        // 샘플 히스토리 데이터
        const sampleHistory = [
            {
                date: '2024.01.15 14:30',
                details: '5개 키워드, 12개 사이트 → 87개 기사 수집',
                status: 'success'
            },
            {
                date: '2024.01.08 09:15',
                details: '5개 키워드, 10개 사이트 → 72개 기사 수집',
                status: 'success'
            },
            {
                date: '2024.01.01 16:45',
                details: '4개 키워드, 8개 사이트 → 실패 (네트워크 오류)',
                status: 'failed'
            }
        ];

        historyContainer.innerHTML = sampleHistory.map(item => `
            <div class="history-item">
                <div class="history-info">
                    <div class="history-date">${item.date}</div>
                    <div class="history-details">${item.details}</div>
                </div>
                <div class="history-status ${item.status}">
                    ${item.status === 'success' ? '성공' : '실패'}
                </div>
            </div>
        `).join('');
    }

    addToHistory(results) {
        // 실제 구현에서는 서버에 저장
        console.log('크롤링 결과 히스토리에 추가:', results);
        this.loadHistory(); // 히스토리 새로고침
    }

    handleCrawlingError(error) {
        this.isRunning = false;
        this.stopElapsedTimer();
        this.hideProgressSection();
        this.enableStartButton();
        
        this.showMessage('크롤링 중 오류가 발생했습니다: ' + error.message, 'error');
    }

    showMessage(message, type = 'info') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'rgb(152, 195, 121)' : 
                        type === 'error' ? 'rgb(224, 108, 117)' : 
                        type === 'warning' ? 'rgb(229, 192, 123)' : 'rgb(86, 182, 194)'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        `;
        
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// 전역 인스턴스
let crawlingController;

// 외부 함수들
function startWeeklyCrawling() {
    if (crawlingController) {
        crawlingController.startWeeklyCrawling();
    }
}

function pauseCrawling() {
    if (crawlingController) {
        crawlingController.pauseCrawling();
    }
}

function stopCrawling() {
    if (crawlingController) {
        crawlingController.stopCrawling();
    }
}

function clearResults() {
    document.getElementById('crawling-results-section').classList.add('hidden');
    crawlingController.showMessage('결과가 지워졌습니다.', 'info');
}

function exportResults() {
    crawlingController.showMessage('결과를 Excel 파일로 내보내는 중...', 'info');
    // 실제 구현에서는 Excel 다운로드
}

function startNewCrawling() {
    clearResults();
    startWeeklyCrawling();
}

function viewAllArticles() {
    crawlingController.showMessage('전체 기사 목록 페이지로 이동합니다.', 'info');
    // 실제 구현에서는 페이지 이동
}

function viewFullHistory() {
    crawlingController.showMessage('전체 크롤링 기록 페이지로 이동합니다.', 'info');
    // 실제 구현에서는 페이지 이동
}

// 초기화
function initCrawlingControl() {
    crawlingController = new CrawlingController();
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    if (typeof crawlingController === 'undefined') {
        initCrawlingControl();
    }
});
</script>
