<!-- í†µê³„ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ -->
<div class="stats-cards-component">
    <div class="component-header">
        <h4 class="component-title">í¬ë¡¤ë§ í†µê³„</h4>
        <div class="component-description">
            í¬ë¡¤ë§ í™œë™ ë° ì„±ê³¼ì— ëŒ€í•œ ì£¼ìš” ì§€í‘œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
        </div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
    <div class="stats-grid" id="stats-grid">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” í†µê³„ ì¹´ë“œë“¤ -->
    </div>

    <!-- í†µê³„ ìƒˆë¡œê³ ì¹¨ -->
    <div class="stats-controls">
        <div class="last-updated">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-updated-time">-</span>
        </div>
        <button class="btn-refresh-stats" onclick="refreshStats()">
            <i class="icon">ğŸ”„</i>
            ìƒˆë¡œê³ ì¹¨
        </button>
    </div>
</div>

<style>
/* í†µê³„ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ */
.stats-cards-component {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
}

.component-header {
    margin-bottom: 24px;
}

.component-title {
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.component-description {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

/* í†µê³„ ê·¸ë¦¬ë“œ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

/* í†µê³„ ì¹´ë“œ */
.stat-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

/* ì¹´ë“œ ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ */
.stat-card.primary {
    border-left: 4px solid rgb(198, 120, 221);
}

.stat-card.secondary {
    border-left: 4px solid rgb(86, 182, 194);
}

.stat-card.success {
    border-left: 4px solid rgb(152, 195, 121);
}

.stat-card.warning {
    border-left: 4px solid rgb(229, 192, 123);
}

.stat-card.danger {
    border-left: 4px solid rgb(224, 108, 117);
}

/* í†µê³„ ì•„ì´ì½˜ */
.stat-icon {
    font-size: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    flex-shrink: 0;
}

.stat-card.primary .stat-icon {
    background: rgba(198, 120, 221, 0.2);
    color: rgb(198, 120, 221);
}

.stat-card.secondary .stat-icon {
    background: rgba(86, 182, 194, 0.2);
    color: rgb(86, 182, 194);
}

.stat-card.success .stat-icon {
    background: rgba(152, 195, 121, 0.2);
    color: rgb(152, 195, 121);
}

.stat-card.warning .stat-icon {
    background: rgba(229, 192, 123, 0.2);
    color: rgb(229, 192, 123);
}

.stat-card.danger .stat-icon {
    background: rgba(224, 108, 117, 0.2);
    color: rgb(224, 108, 117);
}

/* í†µê³„ ë‚´ìš© */
.stat-content {
    flex: 1;
    min-width: 0;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 4px;
    line-height: 1;
}

.stat-label {
    color: rgb(171, 178, 191);
    font-size: 0.95rem;
    font-weight: 500;
    margin-bottom: 8px;
}

.stat-change {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85rem;
    font-weight: 500;
}

.stat-change.positive {
    color: rgb(152, 195, 121);
}

.stat-change.negative {
    color: rgb(224, 108, 117);
}

.stat-change.neutral {
    color: rgb(171, 178, 191);
}

.change-icon {
    font-size: 0.8rem;
}

/* ë¯¸ë‹ˆ ì°¨íŠ¸ */
.stat-mini-chart {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 60px;
    height: 30px;
    opacity: 0.3;
}

.mini-chart-bar {
    display: inline-block;
    width: 3px;
    background: currentColor;
    margin: 0 1px;
    border-radius: 1px;
    animation: chartGrow 0.6s ease-out;
}

/* ë¡œë”© ìƒíƒœ */
.stat-card.loading {
    pointer-events: none;
}

.stat-card.loading .stat-number,
.stat-card.loading .stat-label {
    background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 4px;
    color: transparent;
}

.stat-card.loading .stat-icon {
    opacity: 0.3;
}

/* í†µê³„ ì»¨íŠ¸ë¡¤ */
.stats-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 16px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.last-updated {
    color: rgb(171, 178, 191);
    font-size: 0.9rem;
}

.btn-refresh-stats {
    background: rgba(86, 182, 194, 0.2);
    border: 1px solid rgba(86, 182, 194, 0.3);
    color: rgb(86, 182, 194);
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.btn-refresh-stats:hover {
    background: rgba(86, 182, 194, 0.3);
    transform: translateY(-1px);
}

.btn-refresh-stats:active {
    transform: translateY(0);
}

.btn-refresh-stats.loading {
    pointer-events: none;
    opacity: 0.6;
}

.btn-refresh-stats.loading .icon {
    animation: spin 1s linear infinite;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

@keyframes chartGrow {
    from { height: 0; }
    to { height: var(--height); }
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.stat-card {
    animation: slideUp 0.5s ease-out;
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .stat-card {
        padding: 20px;
        gap: 16px;
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        font-size: 2.5rem;
    }
    
    .stat-number {
        font-size: 2rem;
    }
    
    .stats-controls {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }
}

@media (max-width: 480px) {
    .stat-card {
        flex-direction: column;
        text-align: center;
        padding: 16px;
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        font-size: 2rem;
    }
    
    .stat-number {
        font-size: 1.8rem;
    }
}
</style>

<script>
// í†µê³„ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ JavaScript
class StatsManager {
    constructor() {
        this.stats = [];
        this.isLoading = false;
        this.refreshInterval = null;
        this.init();
    }

    init() {
        this.loadStats();
        this.startAutoRefresh();
    }

    async loadStats() {
        this.setLoading(true);
        
        try {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” API í˜¸ì¶œ
            await this.sleep(1000); // ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
            
            this.stats = await this.fetchStatsData();
            this.renderStats();
            this.updateLastUpdatedTime();
            
        } catch (error) {
            this.handleError(error);
        } finally {
            this.setLoading(false);
        }
    }

    async fetchStatsData() {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ API í˜¸ì¶œ
        // ì—¬ê¸°ì„œëŠ” ìƒ˜í”Œ ë°ì´í„° ë°˜í™˜
        return [
            {
                id: 'active_jobs',
                icon: 'ğŸ”',
                number: 24,
                label: 'í™œì„± í¬ë¡¤ë§ ì‘ì—…',
                change: { value: 5, type: 'positive', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'primary',
                miniChart: [12, 18, 15, 22, 19, 24, 20, 24]
            },
            {
                id: 'collected_articles',
                icon: 'ğŸ“°',
                number: 1247,
                label: 'ì˜¤ëŠ˜ ìˆ˜ì§‘ëœ ê¸°ì‚¬',
                change: { value: 15, type: 'positive', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'secondary',
                miniChart: [800, 950, 1100, 1200, 1150, 1300, 1180, 1247]
            },
            {
                id: 'success_rate',
                icon: 'âš¡',
                number: 98,
                label: 'ìˆ˜ì§‘ ì„±ê³µë¥  (%)',
                change: { value: 2, type: 'positive', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'success',
                miniChart: [95, 96, 94, 97, 98, 96, 99, 98]
            },
            {
                id: 'growth_rate',
                icon: 'ğŸ“ˆ',
                number: 15,
                label: 'ì „ì¼ ëŒ€ë¹„ ì¦ê°€ (%)',
                change: { value: 3, type: 'positive', text: 'ì „ì£¼ ëŒ€ë¹„' },
                type: 'warning',
                miniChart: [8, 12, 10, 15, 18, 14, 16, 15]
            },
            {
                id: 'error_count',
                icon: 'âš ï¸',
                number: 3,
                label: 'ì˜¤ëŠ˜ ë°œìƒí•œ ì˜¤ë¥˜',
                change: { value: 2, type: 'negative', text: 'ì „ì¼ ëŒ€ë¹„' },
                type: 'danger',
                miniChart: [8, 5, 7, 4, 6, 3, 5, 3]
            },
            {
                id: 'processing_time',
                icon: 'â±ï¸',
                number: 12,
                label: 'í‰ê·  ì²˜ë¦¬ì‹œê°„ (ë¶„)',
                change: { value: 1, type: 'negative', text: 'ë‹¨ì¶•ë¨' },
                type: 'secondary',
                miniChart: [15, 14, 16, 13, 12, 14, 11, 12]
            }
        ];
    }

    renderStats() {
        const container = document.getElementById('stats-grid');
        
        container.innerHTML = this.stats.map((stat, index) => `
            <div class="stat-card ${stat.type}" style="animation-delay: ${index * 0.1}s">
                <div class="stat-icon">
                    ${stat.icon}
                </div>
                <div class="stat-content">
                    <div class="stat-number" data-target="${stat.number}">
                        ${this.formatNumber(stat.number)}
                    </div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-change ${stat.change.type}">
                        <span class="change-icon">
                            ${stat.change.type === 'positive' ? 'â†—ï¸' : 
                              stat.change.type === 'negative' ? 'â†˜ï¸' : 'â¡ï¸'}
                        </span>
                        <span>${stat.change.value}% ${stat.change.text}</span>
                    </div>
                </div>
                <div class="stat-mini-chart">
                    ${this.renderMiniChart(stat.miniChart)}
                </div>
            </div>
        `).join('');

        // ìˆ«ì ì¹´ìš´íŠ¸ì—… ì• ë‹ˆë©”ì´ì…˜
        this.animateNumbers();
    }

    renderMiniChart(data) {
        const max = Math.max(...data);
        return data.map(value => {
            const height = (value / max) * 100;
            return `<div class="mini-chart-bar" style="--height: ${height}%; height: ${height}%"></div>`;
        }).join('');
    }

    animateNumbers() {
        const numberElements = document.querySelectorAll('.stat-number[data-target]');
        
        numberElements.forEach(element => {
            const target = parseInt(element.getAttribute('data-target'));
            const duration = 1500; // 1.5ì´ˆ
            const startTime = Date.now();
            
            const updateNumber = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // easeOutQuart ì´ì§• í•¨ìˆ˜
                const easeProgress = 1 - Math.pow(1 - progress, 4);
                const current = Math.floor(target * easeProgress);
                
                element.textContent = this.formatNumber(current);
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                } else {
                    element.textContent = this.formatNumber(target);
                }
            };
            
            updateNumber();
        });
    }

    formatNumber(num) {
        if (num >= 1000) {
            return (num / 1000).toFixed(1).replace('.0', '') + 'K';
        }
        return num.toString();
    }

    setLoading(loading) {
        this.isLoading = loading;
        const refreshBtn = document.querySelector('.btn-refresh-stats');
        
        if (loading) {
            refreshBtn.classList.add('loading');
            this.renderLoadingCards();
        } else {
            refreshBtn.classList.remove('loading');
        }
    }

    renderLoadingCards() {
        const container = document.getElementById('stats-grid');
        const loadingCards = Array(6).fill(0).map(() => `
            <div class="stat-card loading primary">
                <div class="stat-icon">â³</div>
                <div class="stat-content">
                    <div class="stat-number">0000</div>
                    <div class="stat-label">ë¡œë”©ì¤‘...</div>
                    <div class="stat-change neutral">
                        <span>-</span>
                    </div>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = loadingCards;
    }

    updateLastUpdatedTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('ko-KR', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        document.getElementById('last-updated-time').textContent = timeString;
    }

    startAutoRefresh() {
        // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        this.refreshInterval = setInterval(() => {
            this.loadStats();
        }, 5 * 60 * 1000);
    }

    stopAutoRefresh() {
        if (this.refreshInterval) {
            clearInterval(this.refreshInterval);
            this.refreshInterval = null;
        }
    }

    handleError(error) {
        console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
        this.showMessage('í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
        
        // ì˜¤ë¥˜ ì‹œ ê¸°ë³¸ ë°ì´í„° í‘œì‹œ
        this.renderErrorState();
    }

    renderErrorState() {
        const container = document.getElementById('stats-grid');
        container.innerHTML = `
            <div class="error-state" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <div style="font-size: 3rem; margin-bottom: 16px; opacity: 0.5;">âš ï¸</div>
                <div style="color: rgb(224, 108, 117); font-weight: 500; margin-bottom: 8px;">
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div style="color: rgb(171, 178, 191); font-size: 0.9rem; margin-bottom: 20px;">
                    ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                </div>
                <button onclick="refreshStats()" style="
                    background: rgb(86, 182, 194);
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">ë‹¤ì‹œ ì‹œë„</button>
            </div>
        `;
    }

    async refreshStats() {
        if (this.isLoading) return;
        
        this.showMessage('í†µê³„ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
        await this.loadStats();
        this.showMessage('í†µê³„ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    }

    showMessage(message, type = 'info') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? 'rgb(152, 195, 121)' : 
                        type === 'error' ? 'rgb(224, 108, 117)' : 
                        type === 'warning' ? 'rgb(229, 192, 123)' : 'rgb(86, 182, 194)'};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideInRight 0.3s ease;
        `;
        
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    // API ì—°ë™ìš© ë©”ì„œë“œë“¤ (í–¥í›„ êµ¬í˜„)
    async fetchRealTimeStats() {
        try {
            const response = await fetch('/api/admin/stats');
            const data = await response.json();
            if (data.success) {
                return data.stats;
            }
            throw new Error(data.message || 'í†µê³„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨');
        } catch (error) {
            throw error;
        }
    }

    getStatById(id) {
        return this.stats.find(stat => stat.id === id);
    }

    updateStat(id, newValue) {
        const stat = this.getStatById(id);
        if (stat) {
            stat.number = newValue;
            this.renderStats();
        }
    }

    // ì»´í¬ë„ŒíŠ¸ ì •ë¦¬
    destroy() {
        this.stopAutoRefresh();
    }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
let statsManager;

// ì™¸ë¶€ í•¨ìˆ˜ë“¤
function refreshStats() {
    if (statsManager) {
        statsManager.refreshStats();
    }
}

// ì´ˆê¸°í™” í•¨ìˆ˜
function initStatsCards() {
    statsManager = new StatsManager();
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    if (typeof statsManager === 'undefined') {
        initStatsCards();
    }
});

// í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
window.addEventListener('beforeunload', function() {
    if (statsManager) {
        statsManager.destroy();
    }
});
</script>
